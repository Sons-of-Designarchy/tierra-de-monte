{{ 'section-multicolumn-custom-box.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- style -%}
      @font-face {
        font-family: "IBM Plex Mono";
        src: url({{ 'IBMPlexMono-Light.woff2' | asset_url }}) format("woff2");
        font-weight: 300;
        font-style: normal;
        font-display: swap;
      }

      /* Monospace description style */
      #shopify-section-{{ section.id }} .mc-desc--mono,
      #shopify-section-{{ section.id }} .rte.mc-desc--mono {
        font-family: "IBM Plex Mono", "Courier New", Courier, monospace !important;
        font-weight: 300;
        letter-spacing: -0.04em!important;
        line-height: 1.8rem;
        text-transform: uppercase;
      }

      /* Ensure all nested tags inside the RTE inherit these styles */
      #shopify-section-{{ section.id }} .mc-desc--mono * {
        font-family: inherit !important;
        font-weight: inherit;
        line-height: inherit;
        letter-spacing: inherit;
        text-transform: inherit;
      }

      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
        padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
      }
      @media (min-width: 750px) {
        .section-{{ section.id }}-padding {
          padding-top: {{ section.settings.padding_top }}px;
          padding-bottom: {{ section.settings.padding_bottom }}px;
        }
      }



    .section--multicolumn-custom .mc-eyebrow {
      font-family: var(--font-caption-family);
      font-size: 12px;
      letter-spacing: .12em;
      text-transform: uppercase;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(var(--color-foreground), 0.1);
    }


      /* ===== Feature layout (title/desc/CTA left, columns right) ===== */
      #shopify-section-{{ section.id }} .mc-feature__grid { display: grid; gap: 32px; }
      @media (min-width: 990px){
        #shopify-section-{{ section.id }} .mc-feature__grid { grid-template-columns: 5fr 7fr; align-items: start; gap: 48px; }
      }
      #shopify-section-{{ section.id }} .mc-feature__lead { display:flex; flex-direction:column; gap: 16px; }

      #shopify-section-{{ section.id }} .mc-heading { margin: 0; }
      #shopify-section-{{ section.id }} .mc-desc { color: rgb(var(--color-foreground), .8); }
      #shopify-section-{{ section.id }} .mc-cta-wrap { margin-top: 8px; }

      /* ===== Heading size utilities ===== */
      #shopify-section-{{ section.id }} .mc-heading.h2 { font-size: clamp(28px, 3.2vw, 36px); line-height: 1.1; }
      #shopify-section-{{ section.id }} .mc-heading.h1 { font-size: clamp(36px, 4vw, 48px); line-height: 1.05; }
      #shopify-section-{{ section.id }} .mc-heading.h0 { font-size: clamp(44px, 5vw, 64px); line-height: 1.02; }
      #shopify-section-{{ section.id }} .mc-heading.hxl { font-size: clamp(56px, 6vw, 80px); line-height: 1; }
      #shopify-section-{{ section.id }} .mc-heading.hxxl { font-size: clamp(64px, 7vw, 96px); line-height: 1; }

      /* ===== Columns area ===== */
      #shopify-section-{{ section.id }} .multicolumn { border-radius: 8px; }
      #shopify-section-{{ section.id }} .multicolumn__title { display:none; }
      #shopify-section-{{ section.id }} .multicolumn-list { align-items: start; }

      /* Vertical dividers between items (desktop only) — default height */
      @media(min-width: 990px){
        #shopify-section-{{ section.id }} .multicolumn-list__item {
          position: relative;
          padding-left: 8px;
          height: 55vh; /* default; can be overridden per-instance below */
        }
        #shopify-section-{{ section.id }} .multicolumn-list__item + .multicolumn-list__item { border-left: none !important; }
      }

      /* Card layout */
      #shopify-section-{{ section.id }} .multicolumn-card{
        display:flex; flex-direction:column; gap:12px; min-height:100%;
        background: #EBEAE2; border-radius: 8px; padding: 16px;
      }
      /* --- Make info container stick to bottom --- */
      #shopify-section-{{ section.id }} .multicolumn-card { display: flex; flex-direction: column; justify-content: space-between; height: 100%; }
      #shopify-section-{{ section.id }} .multicolumn-card__info { margin-top: auto; }

      /* Image first */
      #shopify-section-{{ section.id }} .multicolumn-card__image-wrapper {
        order: 1; margin-top: 0; width: 100%; border-radius: 8px; overflow: visible; margin-bottom: 12px;
      }
      #shopify-section-{{ section.id }} .multicolumn-card__info { order: 2; }

      /* Icon media wrapper (no enforced ratio, no crop) */
      #shopify-section-{{ section.id }} .multicolumn-card__image-wrapper .media{
        position: relative; padding-bottom: 0 !important; aspect-ratio: auto; display: inline-block;
        width: var(--icon-size, 40px); height: var(--icon-size, 40px); background: transparent; border-radius: 8px; overflow: visible;
      }

      /* Icon sizing and fit */
      #shopify-section-{{ section.id }} .multicolumn-card__image{
        position: static !important; display: block; width: 100%; height: 100%;
        max-width: 60px; max-height: 60px; min-width: 16px; min-height: 16px; object-fit: contain;
      }

      /* Big stat/heading — only non-stat h3s get the clamp size */
      #shopify-section-{{ section.id }} .multicolumn-card h3:not(.mc-stat) { font-size: clamp(61px, 6vw, 96px); line-height: 1; margin: 0 0 4px; }

      /* Description font options */
      #shopify-section-{{ section.id }} .mc-desc--mono{ font-family: 'IBMPlexMono-Light', monospace; font-weight:300; letter-spacing:.02em; }
      #shopify-section-{{ section.id }} .mc-desc--body{ font-family: var(--font-body-family); font-weight: 400; }

      /* Per-block stat sizing */
      #shopify-section-{{ section.id }} .mc-stat{ line-height: 1; margin: 0 0 4px; font-size: var(--stat-size-m, 48px); }
      @media (min-width: 750px){ #shopify-section-{{ section.id }} .mc-stat{ font-size: var(--stat-size-d, 72px); } }

      /* Font style choices */
      #shopify-section-{{ section.id }} .mc-stat--heading{ font-family: var(--font-heading-family); font-weight: var(--font-heading-weight); letter-spacing: var(--heading-letter-spacing, 0); }
      #shopify-section-{{ section.id }} .mc-stat--body{ font-family: var(--font-body-family); font-weight: 600; }
      #shopify-section-{{ section.id }} .mc-stat--mono{ font-family: 'IBMPlexMono-Light', monospace; font-weight: 300; letter-spacing: .02em; }

      /* Normalize nested tags inside the stat */
      #shopify-section-{{ section.id }} .mc-stat :is(h1,h2,h3,h4,h5,h6,p,div,span){ all: unset; font: inherit; line-height: inherit; display: inline; }

      /* ========== Description font overrides ========== */
      #shopify-section-{{ section.id }} .mc-desc--body,
      #shopify-section-{{ section.id }} .rte.mc-desc--body {
        font-family: var(--font-body-family);
        font-weight: 400;
        letter-spacing: 0.02em!important;
        line-height: 1.8rem;
      }

      /* Robust monospace stack (works even if IBM Plex Mono isn't loaded) */
      #shopify-section-{{ section.id }} .mc-desc--mono,
      #shopify-section-{{ section.id }} .rte.mc-desc--mono {
        font-family: "IBM Plex Mono", "Courier New", Courier, monospace !important;
        font-weight: 300;
        letter-spacing: 0.02em;
      }

      /* Make sure children inside RTE inherit it */
      #shopify-section-{{ section.id }} .mc-desc--mono * { font-family: inherit !important; font-weight: inherit; letter-spacing: inherit; }

      /* ===== Instance-only column height override ===== */
      {% if section.settings.use_custom_col_height %}
        @media (min-width: 990px){
          #shopify-section-{{ section.id }} .multicolumn-list__item {
            height: {{ section.settings.col_height_vh_desktop }}vh;
          }
        }
        @media (max-width: 989.98px){
          #shopify-section-{{ section.id }} .multicolumn-list__item {
            height: {{ section.settings.col_height_vh_mobile }}vh;
          }
        }
      {% endif %}


  /* Tablet only — adjust heading size to 2rem */
  @media screen and (min-width: 750px) and (max-width: 989px) {
    .image-with-text__heading {
      font-size: 3rem !important;
      line-height: 1.2; /* optional: keeps rhythm consistent */
    }
    .image-with-text__content {
      align-items: flex-start;
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: center;
      align-self: center;
      padding: 3.5rem!important;
      position: relative;
      z-index: 1;
    }
    a.button {
      margin-top: 24px!important;
    }
  }
{%- endstyle -%}

{%- liquid
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and section.blocks.size > columns_mobile_int
    assign show_mobile_slider = true
  endif
-%}

<div class="multicolumn color-{{ section.settings.color_scheme }} gradient">
  <div
    class="page-width section-{{ section.id }}-padding isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
    {% if settings.animations_reveal_on_scroll %}
      data-cascade
    {% endif %}
  >
    <!-- top: Eyebrow -->
    {% if section.settings.pretitle != blank %}
      <div class="mc-eyebrow">
        {{ section.settings.pretitle }}
        {% if section.settings.show_rule %}
          <div class="mc-eyebrow__rule" aria-hidden="true"></div>
        {% endif %}
      </div>
    {% endif %}
    <div class="mc-feature__grid">
      <!-- Left:Title + Description + CTA -->
      <div class="mc-feature__lead">
        {% if section.settings.title != blank %}
          <h2 class="mc-heading {{ section.settings.heading_size }}">{{ section.settings.title }}</h2>
        {% endif %}

        {% if section.settings.description != blank %}
          <div class="mc-desc rte">{{ section.settings.description }}</div>
        {% endif %}

        {% if section.settings.button_label != blank %}
          <div class="mc-cta-wrap">
            <a
              class="button button--primary"
              {% if section.settings.button_link == blank %}
                role="link" aria-disabled="true"
              {% else %}
                href="{{ section.settings.button_link }}"
              {% endif %}
            >
              {{ section.settings.button_label | escape }}
            </a>
          </div>
        {% endif %}
      </div>

      <!-- Right: Columns / Stats -->
      <div>
        <slider-component class="slider-mobile-gutter">
          <ul
            class="multicolumn-list contains-content-container grid grid--{{ section.settings.columns_mobile }}-col-tablet-down grid--{{ section.settings.columns_desktop }}-col-desktop{% if show_mobile_slider %} slider slider--tablet grid--peek{% endif %}"
            id="Slider-{{ section.id }}"
            role="list"
          >
            {%- for block in section.blocks -%}
              {%- assign empty_column = '' -%}
              {%- if block.settings.image == blank
                and block.settings.title == blank
                and block.settings.text == blank
                and block.settings.link_label == blank
              -%}
                {%- assign empty_column = ' multicolumn-list__item--empty' -%}
              {%- endif -%}

              <li
                id="Slide-{{ section.id }}-{{ forloop.index }}"
                class="multicolumn-list__item grid__item{% if section.settings.swipe_on_mobile %} slider__slide{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}{{ empty_column }}"
                {{ block.shopify_attributes }}
                {% if settings.animations_reveal_on_scroll %}
                  data-cascade style="--animation-order: {{ forloop.index }};"
                {% endif %}
              >
                <div class="multicolumn-card content-container">
                  <!-- INFO (order:2 in CSS) -->
                  <div class="multicolumn-card__info">
                    {%- if block.settings.title != blank -%}
                      <h3
                        class="inline-richtext mc-stat mc-stat--{{ block.settings.stat_font | default: 'heading' }}"
                        style="--stat-size-m: {{ block.settings.stat_size_mobile | default: 48 }}px; --stat-size-d: {{ block.settings.stat_size_desktop | default: 72 }}px;"
                      >
                        {{ block.settings.title }}
                      </h3>
                    {%- endif -%}

                    {%- if block.settings.text != blank -%}
                      <div class="rte {{ block.settings.desc_font | default: 'body' | prepend: 'mc-desc--' }}">
                        {{ block.settings.text }}
                      </div>
                    {%- endif -%}

                    {%- if block.settings.link_label != blank -%}
                      <a
                        class="link animate-arrow"
                        {% if block.settings.link == blank %}
                          role="link" aria-disabled="true"
                        {% else %}
                          href="{{ block.settings.link }}"
                        {% endif %}
                      >
                        {{- block.settings.link_label | escape -}}
                        <span class="svg-wrapper"
                          ><span class="icon-wrap">&nbsp;{{ 'icon-arrow.svg' | inline_asset_content }}</span></span
                        >
                      </a>
                    {%- endif -%}
                  </div>

                  <!-- IMAGE (order:1 in CSS) -->
                  {%- if block.settings.image != blank -%}
                    <div
                      class="multicolumn-card__image-wrapper multicolumn-card-spacing"
                      style="--icon-size: {{ block.settings.icon_size | default: 40 }}px;"
                    >
                      <div class="media media--transparent media--adapt">
                        {%- assign icon_px = block.settings.icon_size | default: 40 -%}
                        {%- capture sizes_attr -%}(min-width: 750px) {{ icon_px }}px, {{ icon_px }}px{%- endcapture -%}
                        {{
                          block.settings.image
                          | image_url: width: 320
                          | image_tag: class: 'multicolumn-card__image', loading: 'lazy', sizes: sizes_attr
                        }}
                      </div>
                    </div>
                  {%- endif -%}
                </div>
              </li>
            {%- endfor -%}
          </ul>

          {%- if show_mobile_slider -%}
            <div class="slider-buttons large-up-hide">
              <button
                type="button"
                class="slider-button slider-button--prev"
                name="previous"
                aria-label="{{ 'general.slider.previous_slide' | t }}"
              >
                <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
              </button>
              <div class="slider-counter caption">
                <span class="slider-counter--current">1</span><span aria-hidden="true"> / </span
                ><span class="visually-hidden">{{ 'general.slider.of' | t }}</span
                ><span class="slider-counter--total">{{ section.blocks.size }}</span>
              </div>
              <button
                type="button"
                class="slider-button slider-button--next"
                name="next"
                aria-label="{{ 'general.slider.next_slide' | t }}"
              >
                <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
              </button>
            </div>
          {%- endif -%}
        </slider-component>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Multicolumn — Custom box",
  "class": "section section--multicolumn-custom",
  "tag": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "pretitle",
      "label": "Pre-title (eyebrow)",
      "default": "SOLUCIONES ESTRATÉGICAS, RESULTADOS EXCEPCIONALES"
    },
    { "type": "color", "id": "rule_color", "label": "Eyebrow rule color", "default": "#294E3F" },
    { "type": "checkbox", "id": "show_rule", "label": "Show eyebrow rule", "default": true },

    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Title",
      "default": "Efecto Tierra de monte\nInnovación que siembra futuro"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Nuestros productos están respaldados por ciencia y diseñados para trabajar en equilibrio con la naturaleza...</p>"
    },

    { "type": "text", "id": "button_label", "label": "Button label", "default": "Encuentra tu solución" },
    { "type": "url", "id": "button_link", "label": "Button link" },

    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        { "value": "h2", "label": "H2" },
        { "value": "h1", "label": "H1" },
        { "value": "h0", "label": "H0" },
        { "value": "hxl", "label": "HXL" },
        { "value": "hxxl", "label": "HXXL" }
      ],
      "default": "h1"
    },

    { "type": "header", "content": "Layout" },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "Columns on desktop"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "1",
      "label": "Columns on mobile"
    },
    { "type": "checkbox", "id": "swipe_on_mobile", "default": false, "label": "Swipe on mobile" },
    { "type": "color", "id": "divider_color", "label": "Divider color (desktop)", "default": "#1a1a1a" },

    { "type": "header", "content": "Visual" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "background-1" },

    /* ===== Instance-only column height controls ===== */
    { "type": "header", "content": "Column height (instance only)" },
    {
      "type": "checkbox",
      "id": "use_custom_col_height",
      "label": "Override column height for this section",
      "default": false
    },
    {
      "type": "range",
      "id": "col_height_vh_desktop",
      "label": "Column height on desktop (vh)",
      "min": 20,
      "max": 100,
      "step": 1,
      "default": 35
    },
    {
      "type": "range",
      "id": "col_height_vh_mobile",
      "label": "Column height on mobile (vh)",
      "min": 20,
      "max": 100,
      "step": 1,
      "default": 35
    },
    /* =============================================== */

    { "type": "header", "content": "Padding" },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "settings": [
        {
          "type": "select",
          "id": "desc_font",
          "label": "Description font",
          "options": [
            { "value": "body", "label": "Regular body" },
            { "value": "mono", "label": "Monospace (IBM Plex Mono Light)" }
          ],
          "default": "body"
        },

        { "type": "image_picker", "id": "image", "label": "Image" },
        {
          "type": "range",
          "id": "icon_size",
          "label": "Icon size (px)",
          "min": 16,
          "max": 60,
          "step": 1,
          "default": 40
        },

        { "type": "inline_richtext", "id": "title", "label": "Heading / Stat", "default": "+230" },
        {
          "type": "select",
          "id": "stat_font",
          "label": "Heading/Stat font style",
          "options": [
            { "value": "heading", "label": "Theme heading" },
            { "value": "body", "label": "Theme body (bold)" },
            { "value": "mono", "label": "Monospace (IBM Plex Mono Light)" }
          ],
          "default": "heading"
        },
        {
          "type": "range",
          "id": "stat_size_mobile",
          "label": "Heading/Stat size (mobile, px)",
          "min": 8,
          "max": 108,
          "step": 1,
          "unit": "px",
          "default": 48
        },
        {
          "type": "range",
          "id": "stat_size_desktop",
          "label": "Heading/Stat size (desktop, px)",
          "min": 8,
          "max": 108,
          "step": 1,
          "unit": "px",
          "default": 72
        },

        { "type": "richtext", "id": "text", "label": "Text", "default": "<p>Hectáreas regeneradas</p>" },
        { "type": "text", "id": "link_label", "label": "Link label" },
        { "type": "url", "id": "link", "label": "Link" }
      ]
    }
  ],
  "presets": [
    { "name": "Multicolumn — custom box", "blocks": [{ "type": "column" }, { "type": "column" }, { "type": "column" }] }
  ]
}
{% endschema %}
