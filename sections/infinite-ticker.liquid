{% comment %}
  Infinite Ticker â€” Dawn 15.4.0
  - Full-width background image with overlay
  - Single-line, non-wrapping scrolling text
  - Choose font: heading/body/custom
{% endcomment %}

{% liquid
  assign s = section.settings
  assign bg = s.bg_image
  assign overlay = s.overlay_color
  assign overlay_opacity = s.overlay_opacity | divided_by: 100.0
  assign font_choice = s.font_choice
  assign custom_family = s.custom_font_family | strip
%}

<section id="ticker-{{ section.id }}" class="tdm-ticker">
  <div class="tdm-ticker__bg{% if s.rounded %} tdm-ticker__bg--rounded{% endif %}">
    {% if bg %}
      {%- comment -%} we still render an <img> for LCP, but hide it; background-image does the visual {%- endcomment -%}
      {{ bg | image_url: width: 2880 | image_tag: alt: s.bg_alt, class: 'tdm-ticker__bg-img', loading: 'lazy' }}
    {% endif %}
    <div class="tdm-ticker__overlay" aria-hidden="true"></div>

    <div class="tdm-ticker__marquee" style="--speed: {{ s.speed }}s; --gap: {{ s.gap }}rem;">
      <div class="tdm-ticker__track">
        {%- for i in (1..8) -%}
          <span class="tdm-ticker__item">{{ s.text }}</span>
        {%- endfor -%}
      </div>
      <div class="tdm-ticker__track" aria-hidden="true">
        {%- for i in (1..8) -%}
          <span class="tdm-ticker__item">{{ s.text }}</span>
        {%- endfor -%}
      </div>
    </div>
  </div>

  <style>
    /* Container */
    #ticker-{{ section.id }}{
      --h: {{ s.height }}px;
      --overlay: {{ overlay }};
      --overlay-o: {{ overlay_opacity }};
      --fs: {{ s.font_size }}px;
      --ls: {{ s.letter_spacing }}em;
      --c: {{ s.text_color }};
    }
    #ticker-{{ section.id }} .tdm-ticker__bg{
      position: relative;
      height: var(--h);
      overflow: hidden;
      {% if bg %}
        background-image: url({{ bg | image_url: width: 2880 }});
        background-size: cover;
        background-position: center;
      {% endif %}
      border-radius: {% if s.rounded %}{{ s.radius }}px{% else %}0{% endif %};
    }
    #ticker-{{ section.id }} .tdm-ticker__bg-img{ display:none; } /* purely for LCP */

    /* Overlay */
    #ticker-{{ section.id }} .tdm-ticker__overlay{
      position:absolute; inset:0;
      background: var(--overlay);
      opacity: var(--overlay-o);
      pointer-events:none;
    }

    /* Marquee shell */
    #ticker-{{ section.id }} .tdm-ticker__marquee{
      position:absolute; inset:auto 0 0 0; /* bottom aligned like the mock */
      height: calc(var(--h) * 0.45);      /* ticker band height (adjust if needed) */
      display:flex; align-items:center;
      overflow: hidden;
      padding: 0 12px;
      border-top: 1px solid rgba(0,0,0,.25);
    }

    /* Two tracks for seamless loop */
    #ticker-{{ section.id }} .tdm-ticker__track{
      display: inline-flex;
      align-items: center;
      gap: var(--gap);
      white-space: nowrap;           /* keep on one line */
      will-change: transform;
      animation: ticker-{{ section.id }} var(--speed) linear infinite;
      padding-right: var(--gap);
    }
    @keyframes ticker-{{ section.id }} {
      from { transform: translateX(0); }
      to   { transform: translateX(-50%); }
    }

    /* Items */
    #ticker-{{ section.id }} .tdm-ticker__item{
      font-size: var(--fs);
      letter-spacing: var(--ls);
      color: var(--c);
      line-height: 1;
      display:inline-block;
      white-space: nowrap;       /* make 100% sure it never wraps */
    }

    /* Font choice */
    {% if font_choice == 'heading' %}
      #ticker-{{ section.id }} .tdm-ticker__item{ font-family: var(--font-heading-family); font-weight: var(--font-heading-weight); }
    {% elsif font_choice == 'body' %}
      #ticker-{{ section.id }} .tdm-ticker__item{ font-family: var(--font-body-family); font-weight: 400; }
    {% elsif font_choice == 'custom' and custom_family != blank %}
      #ticker-{{ section.id }} .tdm-ticker__item{ font-family: {{ custom_family }}; font-weight: 400; }
    {% endif %}

    /* Mobile tweaks */
    @media (max-width: 749px){
      #ticker-{{ section.id }}{ --fs: {{ s.font_size_mobile }}px; }
      #ticker-{{ section.id }} .tdm-ticker__marquee{ height: calc(var(--h) * 0.5); }
    }
  </style>
</section>

{% schema %}
{
  "name": "Infinite Ticker",
  "settings": [
    { "type": "image_picker", "id": "bg_image", "label": "Background image" },
    { "type": "text", "id": "bg_alt", "label": "Background alt text" },

    { "type": "checkbox", "id": "rounded", "label": "Rounded corners", "default": false },
    { "type": "range", "id": "radius", "label": "Corner radius", "min": 0, "max": 32, "step": 1, "default": 12 },

    {
      "type": "range",
      "id": "height",
      "label": "Section height (px)",
      "min": 120,
      "max": 520,
      "step": 10,
      "default": 220
    },

    { "type": "text", "id": "text", "label": "Ticker text", "default": "VIDA QUE GENERA VIDA" },

    {
      "type": "select",
      "id": "font_choice",
      "label": "Font",
      "default": "heading",
      "options": [
        { "value": "heading", "label": "Use Heading font" },
        { "value": "body", "label": "Use Body font" },
        { "value": "custom", "label": "Custom family (below)" }
      ]
    },
    {
      "type": "text",
      "id": "custom_font_family",
      "label": "Custom font-family (e.g. 'YourFont', serif)",
      "default": ""
    },

    {
      "type": "range",
      "id": "font_size",
      "label": "Font size (desktop, px)",
      "min": 10,
      "max": 80,
      "step": 1,
      "default": 22
    },
    {
      "type": "range",
      "id": "font_size_mobile",
      "label": "Font size (mobile, px)",
      "min": 10,
      "max": 48,
      "step": 1,
      "default": 18
    },
    { "type": "text", "id": "text_color", "label": "Text color (CSS)", "default": "#F3EFCF" },
    {
      "type": "range",
      "id": "letter_spacing",
      "label": "Letter spacing (em)",
      "min": 0,
      "max": 0.3,
      "step": 0.01,
      "default": 0.08
    },

    {
      "type": "text",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "linear-gradient(180deg, rgba(0,0,0,0.0) 0%, rgba(0,0,0,0.50) 100%)"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity (for solid colors only)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 100
    },

    {
      "type": "range",
      "id": "gap",
      "label": "Space between repeats (rem)",
      "min": 0,
      "max": 8,
      "step": 0.25,
      "default": 3
    },
    {
      "type": "range",
      "id": "speed",
      "label": "Scroll duration (seconds, lower = faster)",
      "min": 6,
      "max": 40,
      "step": 1,
      "default": 18
    }
  ],
  "presets": [{ "name": "Infinite Ticker" }]
}
{% endschema %}
