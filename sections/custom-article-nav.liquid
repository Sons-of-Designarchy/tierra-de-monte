{%- assign current_raw = canonical_url | default: request.path | default: '' -%}
{%- assign current_path = current_raw | split: '?' | first | remove: shop.url | remove_last: '/' -%}

{%- assign back_url = routes.blogs_url -%}
{%- assign next_url = routes.blogs_url -%}

{%- assign all_articles = '' | split: ',' -%}
{%- for b in blogs -%}
  {%- assign bo = b[1] -%}
  {%- if bo and bo.articles_count > 0 -%}
    {%- assign all_articles = all_articles | concat: bo.articles -%}
  {%- endif -%}
{%- endfor -%}

{%- assign sorted = all_articles | sort: 'published_at' -%}

{%- assign found_current = false -%}
{%- assign first_other_url = blank -%}
{%- assign picked = false -%}

{%- for a in sorted -%}
  {%- if a and a.url != blank and a.published_at != blank -%}
    {%- assign a_path = a.url | split: '?' | first | remove_last: '/' -%}

    {%- if a_path != current_path and first_other_url == blank -%}
      {%- assign first_other_url = a.url -%}
    {%- endif -%}

    {%- if found_current and picked == false and a_path != current_path -%}
      {%- assign next_url = a.url -%}
      {%- assign picked = true -%}
      {%- break -%}
    {%- endif -%}

    {%- if a_path == current_path -%}
      {%- assign found_current = true -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{%- if picked == false and first_other_url != blank -%}
  {%- assign next_url = first_other_url -%}
{%- endif -%}

<section class="section-{{ section.id }}-padding color-scheme-{{ section.settings.color_scheme }} gradient">
  <div class="page-width">
    <nav class="anav" aria-label="Article navigation">
      <a class="anav__btn anav__btn--back" href="{{ back_url }}">
        {{ section.settings.back_label | default: 'Regresar' }}
      </a>

      <a class="anav__btn anav__btn--next" href="{{ next_url }}">
        {{ section.settings.next_label | default: 'Siguiente blog' }}
      </a>
    </nav>
  </div>
</section>

{% style %}
  .section-{{ section.id }}-padding{padding-top:{{ section.settings.padding_top }}px;padding-bottom:{{ section.settings.padding_bottom }}px}
  .anav{display:grid;grid-template-columns:1fr 1fr;border:1px solid currentColor;border-radius:12px;overflow:hidden}
  .anav__btn{display:flex;align-items:center;justify-content:center;min-height:48px;padding:.9rem 1.2rem;text-decoration:none;color:inherit}
  .anav__btn--back{border-right:1px solid currentColor}
  @media (max-width:480px){.anav{grid-template-columns:1fr 1fr}}
{% endstyle %}

{% schema %}
{
  "name": "Custom article nav",
  "settings": [
    { "type": "text", "id": "back_label", "label": "Back label", "default": "Regresar" },
    { "type": "text", "id": "next_label", "label": "Next label", "default": "Siguiente blog" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "label": "Padding top", "min": 0, "max": 48, "step": 1, "default": 12 },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 48,
      "step": 1,
      "default": 12
    }
  ],
  "presets": [{ "name": "Custom article nav (global)" }]
}
{% endschema %}
