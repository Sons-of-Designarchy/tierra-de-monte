<section id="ticker-{{ section.id }}" class="color-{{ section.settings.color_scheme }}">
  <style>
    /* ===== Container ===== */
    #ticker-{{ section.id }}{
      --gap: 2.2rem;
      --speed: 28s;
      --h: {{ section.settings.height | default: 100 }}px;
      position: relative;
      min-height: var(--h);
      overflow: hidden;

      /* ⛔️ kill color-scheme background just for THIS section */
      background: transparent !important;
      z-index: 0; /* create a stacking context */
    }
    /* Some versions of Dawn draw the color-scheme using ::before/::after */
    #ticker-{{ section.id }}::before,
    #ticker-{{ section.id }}::after{
      content: none !important;
      display: none !important;
    }

    /* ===== Background + overlay layering (bring to front) ===== */
    #ticker-{{ section.id }} .ticker-bg{
      position: absolute; inset: 0;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      z-index: 1; /* above any scheme layer */
    }
    #ticker-{{ section.id }} .ticker-overlay{
      position: absolute; inset: 0;
      pointer-events: none;
      z-index: 2; /* above bg */
    }

    /* ===== Ticker band (centered) ===== */
    #ticker-{{ section.id }} .ticker{
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      padding: 0; border: 0; background: transparent;
      z-index: 3; /* topmost */
    }

    /* Typography */
    #ticker-{{ section.id }} .typo-primary{
      font-family: var(--font-heading-family);
      font-weight: var(--font-heading-weight);
      font-size: clamp(16px, 2vw, 22px);
      line-height: 1; letter-spacing: .08em; text-transform: uppercase;
      white-space: nowrap;
    }
    #ticker-{{ section.id }} .typo-secondary{
      font-family: var(--font-body-family);
      font-weight: 400;
      font-size: clamp(14px, 1.7vw, 18px);
      line-height: 1; letter-spacing: .08em; text-transform: uppercase;
      white-space: nowrap;
    }

    /* Force ticker text color (overrides scheme's green) */
    #ticker-{{ section.id }} .track{
      color: {{ section.settings.text_color | default: '#F3EFCF' }};
    }

    /* Seamless marquee */
    #ticker-{{ section.id }} .marquee{ width: 100%; overflow: hidden; }
    #ticker-{{ section.id }} .track{
      display: inline-flex; align-items: center; gap: var(--gap);
      will-change: transform;
      animation: ticker-{{ section.id }} var(--speed) linear infinite;
    }
    #ticker-{{ section.id }} .chunk{
      display: inline-flex; align-items: center; gap: var(--gap);
    }
    #ticker-{{ section.id }} .item{ display:inline-flex; align-items:center; gap:.6rem }
    #ticker-{{ section.id }} .icon{ width:18px; height:18px; object-fit:contain; flex:0 0 18px }

    @keyframes ticker-{{ section.id }}{
      from { transform: translateX(0); }
      to   { transform: translateX(-50%); }
    }
  </style>

  {%- comment -%}
    We set styles inline so Liquid comparisons aren't inside CSS rules,
    ensuring the background & overlay always apply.
  {%- endcomment -%}

  {%- if section.settings.bg_image != blank -%}
    <div
      class="ticker-bg"
      style="background-image:url({{ section.settings.bg_image | image_url: width: 2880 }});"
    ></div>
  {%- else -%}
    <div class="ticker-bg"></div>
  {%- endif -%}

  <div
    class="ticker-overlay"
    style="background: {{ section.settings.bg_color | default: 'transparent' }};{% if section.settings.overlay_opacity %} opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};{% endif %}"
  ></div>

  <div class="ticker">
    {% assign copy = section.settings.text | strip | default: 'VIDA QUE GENERA VIDA' %}
    <div class="marquee">
      <div class="track {% if section.settings.typography_variant == 'primary' %}typo-primary{% else %}typo-secondary{% endif %}">
        <!-- chunk A -->
        <span class="chunk">
          {% for i in (1..10) %}
            <span class="item">
              {% if section.settings.icon != blank %}
                <img
                  alt=""
                  class="icon"
                  src="{{ section.settings.icon | image_url }}"
                  width="18"
                  height="18"
                  loading="lazy"
                >
              {% endif %}
              <span>{{ copy }}</span>
            </span>
          {% endfor %}
        </span>
        <!-- chunk B (duplicate) -->
        <span class="chunk" aria-hidden="true">
          {% for i in (1..10) %}
            <span class="item">
              {% if section.settings.icon != blank %}
                <img
                  alt=""
                  class="icon"
                  src="{{ section.settings.icon | image_url }}"
                  width="18"
                  height="18"
                  loading="lazy"
                >
              {% endif %}
              <span>{{ copy }}</span>
            </span>
          {% endfor %}
        </span>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Infinite Ticker",
  "settings": [
    { "type": "text", "id": "text", "label": "Text", "default": "VIDA QUE GENERA VIDA" },
    { "type": "image_picker", "id": "icon", "label": "Icon" },
    { "type": "image_picker", "id": "bg_image", "label": "Background image" },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 30
    },

    {
      "type": "range",
      "id": "height",
      "label": "Section height (px)",
      "min": 60,
      "max": 200,
      "step": 5,
      "default": 100
    },
    { "type": "color", "id": "text_color", "label": "Ticker text color", "default": "#F3EFCF" },

    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "background-1" },
    {
      "type": "select",
      "id": "typography_variant",
      "label": "Typography",
      "options": [
        { "value": "primary", "label": "Heading font (uppercase)" },
        { "value": "secondary", "label": "Body font (uppercase)" }
      ],
      "default": "primary"
    }
  ],
  "presets": [{ "name": "Infinite Ticker" }]
}
{% endschema %}
