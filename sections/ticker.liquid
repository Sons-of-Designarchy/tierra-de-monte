<section id="ticker-{{ section.id }}" class="tdm-ticker">
  {% liquid
    assign base_speed = section.settings.speed | default: 36
    assign speed = base_speed
    if section.settings.font_variant == 'mono'
      assign speed = base_speed | plus: 8
    endif
  %}
  <style>
        /* ===== Container ===== */
        #ticker-{{ section.id }}{
          --gap: 2.2rem;
          --speed: {{ speed }}s;                 /* slower, esp. in mono */
          --h: {{ section.settings.height | default: 100 }}px;
          --fs: {{ section.settings.font_size | default: 22 }}px;
          --icon-h: {{ section.settings.icon_height | default: 32 }}px;
          --text-color: {{ section.settings.text_color | default: '#F3EFCF' }};
          position: relative;
          min-height: var(--h);
          overflow: hidden;
          isolation: isolate;
          background: {{ section.settings.bg_color | default: 'transparent' }};
          border-top: {% if section.settings.show_top_border %}1px solid var(--text-color){% else %}none{% endif %};
          border-bottom: {% if section.settings.show_bottom_border %}1px solid var(--text-color){% else %}none{% endif %};
        }

        /* Background image */
        #ticker-{{ section.id }} .ticker-img{
          position:absolute; inset:0;
          width:100%; height:100%;
          object-fit:cover; object-position:center;
          z-index:1;
          display:block;
        }

        /* Ticker layer */
        #ticker-{{ section.id }} .ticker{
          position:absolute; inset:0;
          display:flex; align-items:center; justify-content:center;
          padding:0; border:0; background:transparent;
          z-index:2;
        }

        /* Typography */
        #ticker-{{ section.id }} .typo-primary,
        #ticker-{{ section.id }} .typo-secondary{
          line-height:1;
          white-space:nowrap;
          color: var(--text-color);
          font-size: var(--fs);
          text-transform:
            {% if section.settings.text_transform == 'none' %}none
            {% elsif section.settings.text_transform == 'title' %}capitalize
            {% else %}uppercase
            {% endif %};
        }

        #ticker-{{ section.id }} .typo-primary{
          font-family: var(--font-heading-family);
          font-weight: lighter;
          letter-spacing: -0.5rem; /* tighter for heading style */

        }

        #ticker-{{ section.id }} .typo-secondary{
          font-family: var(--font-body-family);
          font-weight: 400;
          letter-spacing: .08em;
        }

        /* Monospace toggle */
        {% if section.settings.font_variant == 'mono' %}
      #ticker-{{ section.id }}{
        /* pull from your global theme tokens */
        --ticker-mono-family: var(--font-mono-family);
        --ticker-mono-style:  var(--font-mono-style);
        --ticker-mono-weight: var(--font-mono-weight);
        --ticker-mono-scale:  var(--font-mono-scale, 1);
      }

      #ticker-{{ section.id }} .typo-primary,
      #ticker-{{ section.id }} .typo-secondary{
        font-family: var(--ticker-mono-family) !important;
        font-style:  var(--ticker-mono-style) !important;
        font-weight: var(--ticker-mono-weight) !important;

        /* respect mono scale */
        font-size: calc(var(--fs) * var(--ticker-mono-scale));

        /* mono-friendly spacing */
        letter-spacing: 0.06em;

        font-synthesis: none;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
    {% endif %}


        /* Seamless marquee */
        #ticker-{{ section.id }} .marquee{ width:100%; overflow:hidden; }
        #ticker-{{ section.id }} .track{
          display:inline-flex; align-items:center; gap:var(--gap);
          will-change:transform;
          animation: ticker-{{ section.id }} var(--speed) linear infinite;
        }
        #ticker-{{ section.id }} .chunk{
          display:inline-flex; align-items:center; gap:var(--gap);
        }
        #ticker-{{ section.id }} .item{ display:inline-flex; align-items:center; gap:2rem }
        #ticker-{{ section.id }} .icon{
          height:var(--icon-h);
          width:auto;
          max-height:55px;
          object-fit:contain;
          flex:0 0 auto;
        }

        @keyframes ticker-{{ section.id }}{
          from { transform: translateX(0); }
          to   { transform: translateX(-50%); }
        }
  </style>

  {% if section.settings.bg_image != blank %}
    <img
      class="ticker-img"
      src="{{ section.settings.bg_image | image_url: width: 2880 }}"
      alt=""
      loading="lazy"
      aria-hidden="true"
    >
  {% endif %}

  <div class="ticker">
    {% assign copy = section.settings.text | strip | default: 'VIDA QUE GENERA VIDA' %}
    <div class="marquee">
      <div class="track {% if section.settings.typography_variant == 'primary' %}typo-primary{% else %}typo-secondary{% endif %}">
        <span class="chunk">
          {% for i in (1..10) %}
            <span class="item">
              {% if section.settings.icon != blank %}
                <img
                  alt=""
                  class="icon"
                  src="{{ section.settings.icon | image_url }}"
                  height="{{ section.settings.icon_height | default: 32 }}"
                  loading="lazy"
                >
              {% endif %}
              <span>{{ copy }}</span>
            </span>
          {% endfor %}
        </span>
        <span class="chunk" aria-hidden="true">
          {% for i in (1..10) %}
            <span class="item">
              {% if section.settings.icon != blank %}
                <img
                  alt=""
                  class="icon"
                  src="{{ section.settings.icon | image_url }}"
                  height="{{ section.settings.icon_height | default: 32 }}"
                  loading="lazy"
                >
              {% endif %}
              <span>{{ copy }}</span>
            </span>
          {% endfor %}
        </span>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Infinite Ticker",
  "settings": [
    { "type": "text", "id": "text", "label": "Text", "default": "VIDA QUE GENERA VIDA" },
    { "type": "image_picker", "id": "icon", "label": "Icon" },
    {
      "type": "range",
      "id": "icon_height",
      "label": "Icon height (px)",
      "min": 12,
      "max": 55,
      "step": 1,
      "default": 32
    },
    { "type": "image_picker", "id": "bg_image", "label": "Background image" },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#00000000" },

    { "type": "color", "id": "text_color", "label": "Ticker text color", "default": "#F3EFCF" },
    {
      "type": "range",
      "id": "font_size",
      "label": "Text size (px)",
      "min": 12,
      "max": 100,
      "step": 1,
      "default": 22
    },
    {
      "type": "select",
      "id": "text_transform",
      "label": "Text transform",
      "options": [
        { "value": "uppercase", "label": "Uppercase" },
        { "value": "title", "label": "Title Case" },
        { "value": "none", "label": "None" }
      ],
      "default": "uppercase"
    },

    {
      "type": "select",
      "id": "typography_variant",
      "label": "Typography",
      "options": [
        { "value": "primary", "label": "Heading font" },
        { "value": "secondary", "label": "Body font" }
      ],
      "default": "primary"
    },
    {
      "type": "select",
      "id": "font_variant",
      "label": "Font style",
      "options": [
        { "value": "normal", "label": "Normal (theme font)" },
        { "value": "mono", "label": "Monospace (IBMPlexMono-Light)" }
      ],
      "default": "normal"
    },

    {
      "type": "range",
      "id": "speed",
      "label": "Scroll duration (slower = bigger, seconds)",
      "min": 12,
      "max": 80,
      "step": 1,
      "default": 36
    },

    { "type": "checkbox", "id": "show_top_border", "label": "Show top border", "default": true },
    { "type": "checkbox", "id": "show_bottom_border", "label": "Show bottom border", "default": true },

    {
      "type": "range",
      "id": "height",
      "label": "Section height (px)",
      "min": 60,
      "max": 200,
      "step": 5,
      "default": 100
    }
  ],
  "presets": [{ "name": "Infinite Ticker" }]
}
{% endschema %}
