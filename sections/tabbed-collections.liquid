<section id="tabbed-collections-{{ section.id }}" class="page-width">
  {% if section.settings.kicker != blank %}
    <p class="caption-with-letter-spacing">{{ section.settings.kicker }}</p>
  {% endif %}
  {% if section.settings.heading != blank %}
    <h1 class="h1">{{ section.settings.heading }}</h1>
  {% endif %}
  {% if section.settings.subheading != blank %}
    <p class="subtitle">{{ section.settings.subheading }}</p>
  {% endif %}

  {%- assign has_any = false -%}
  {%- for i in (1..6) -%}
    {%- capture key %}collection_{{ i }}{% endcapture -%}
    {%- assign c = section.settings[key] -%}
    {%- if c != blank -%}{%- assign has_any = true -%}{%- endif -%}
  {%- endfor -%}

  {% if has_any %}
    <div class="tabs">
      <div class="tabs__list" role="tablist">
        {%- assign first_rendered = true -%}
        {%- for i in (1..6) -%}
          {%- capture ckey %}collection_{{ i }}{% endcapture -%}
          {%- capture lkey %}label_{{ i }}{% endcapture -%}
          {%- capture dkey %}dot_{{ i }}{% endcapture -%}
          {%- capture ikey %}icon_{{ i }}{% endcapture -%}
          {%- assign c = section.settings[ckey] -%}
          {%- if c != blank -%}
            {%- assign label = section.settings[lkey] | default: c.title -%}
            {%- assign icon = section.settings[ikey] -%}
            <button
              class="tabs__tab{% if first_rendered %} is-active{% endif %}"
              type="button"
              role="tab"
              aria-selected="{% if first_rendered %}true{% else %}false{% endif %}"
              data-target="tc-panel-{{ section.id }}-{{ i }}"
            >
              {%- if icon != blank -%}
                {{ icon | image_url: width: 28 | image_tag: class: 'tabs__icon-img', alt: '' }}
              {%- elsif section.settings[dkey] -%}
                <span class="tabs__dot"></span>
              {%- endif -%}
              <span class="tabs__label">{{ label }}</span>
            </button>
            {%- assign first_rendered = false -%}
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>

    <div class="tabs__panels">
      {%- assign first_panel = true -%}
      {%- for i in (1..6) -%}
        {%- capture ckey %}collection_{{ i }}{% endcapture -%}
        {%- assign c = section.settings[ckey] -%}
        {%- if c != blank -%}
          <div
            id="tc-panel-{{ section.id }}-{{ i }}"
            class="tabs__panel{% unless first_panel %} is-hidden{% endunless %}"
            role="tabpanel"
          >
            {% liquid
              assign prod_limit = section.settings.products_limit | plus: 0
            %}
            <div class="grid grid--2-col-tablet grid--4-col-desktop">
              {% for product in c.products limit: prod_limit %}
                <div class="grid__item">
                  {% render 'card-product', card_product: product, section_id: section.id, show_excerpt: true %}
                </div>
              {% endfor %}
            </div>

            {% if section.settings.show_view_all and c.url %}
              <div class="center" style="margin-top:1rem;">
                <a href="{{ c.url }}" class="button tc__cta">
                  {{ section.settings.view_all_label | default: 'Ver más productos' }}
                </a>
              </div>
            {% endif %}
          </div>

          {%- assign first_panel = false -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  {% else %}
    <p style="opacity:.7">Set “Collection 1…6” in the section settings.</p>
  {% endif %}
</section>

<style>
          /* Section spacing */
          #tabbed-collections-{{ section.id }} {
            --tc-border: rgba(var(--color-foreground), .25);
            --tc-active-bg: #dfeadf;
            --tc-dot: #2fb673;
            --tc-gap: 12px;
            padding-top: 80px;
            padding-bottom: 80px;
          }

          /* Headings + subtitle centered */
          #tabbed-collections-{{ section.id }} .caption-with-letter-spacing,
          #tabbed-collections-{{ section.id }} .h1,
          #tabbed-collections-{{ section.id }} .subtitle {
            text-align: center;
            margin-left: auto;
            margin-right: auto;
          }
          #tabbed-collections-{{ section.id }} .h1 { margin: .5rem 0 0; }
          #tabbed-collections-{{ section.id }} .subtitle { margin: .5rem 0 2.25rem; opacity: .9; }

          /* ===== Tabs row: full-width responsive grid ===== */
          #tabbed-collections-{{ section.id }} .tabs__list{
            display: grid !important;                /* kill old flex rules */
            width: 100%;
            gap: var(--tc-gap);
            margin: 2rem 0 2rem;
            grid-template-columns: repeat(2, minmax(0, 1fr));     /* mobile */
          }
          @media (min-width: 750px){
            #tabbed-collections-{{ section.id }} .tabs__list{
              grid-template-columns: repeat(3, minmax(0, 1fr));
            }
          }
          @media (min-width: 990px){
            #tabbed-collections-{{ section.id }} .tabs__list{
              grid-template-columns: repeat(6, minmax(0, 1fr));   /* 6 tabs across */
            }
          }

          /* Pill buttons */
          #tabbed-collections-{{ section.id }} .tabs__tab{
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: .55rem;
            border: 1px solid var(--tc-border);
            border-radius: 4px;
            background: #f7f3ee;
            padding: .65rem .95rem;
            line-height: 1;
            cursor: pointer;
            transition: background .15s ease, border-color .15s ease, box-shadow .15s ease;
          }
          #tabbed-collections-{{ section.id }} .tabs__tab:hover{
            background: rgba(var(--color-foreground), .05);
          }
          #tabbed-collections-{{ section.id }} .tabs__tab.is-active{
            background: #E4E7C3;
            border-color: #E4E7C3;
            color: #1F4D37;

            box-shadow: inset 0 -1px 0 rgba(0,0,0,.06);
          }

          /* Icon / dot */
          #tabbed-collections-{{ section.id }} .tabs__icon-img{ width:18px; height:18px; object-fit:contain; flex:0 0 auto; }
          #tabbed-collections-{{ section.id }} .tabs__label{ white-space:nowrap; }
          #tabbed-collections-{{ section.id }} .tabs__dot{ width:.9rem; height:.9rem; border-radius:50%; background: var(--tc-dot); flex:0 0 auto; }

          /* Panels */
          #tabbed-collections-{{ section.id }} .tabs__panel.is-hidden{ display:none !important; margin: 2.25rem 0 2.25rem; }

          /* Product grid + CTA */
          #tabbed-collections-{{ section.id }} .grid__item { margin-bottom: 1.25rem; }
          #tabbed-collections-{{ section.id }} .center { text-align: center; }
          #tabbed-collections-{{ section.id }} .tc__cta{ border-radius: 999px; padding: .6rem 1.1rem; }
          #tabbed-collections-{{ section.id }} .badge { border-radius: 999px; }


          /* === Fix long labels + fill full width === */

        /* Make the row auto-fit without empty space on the right */
        #tabbed-collections-{{ section.id }} .tabs__list{
          display: grid !important;
          width: 100%;
          gap: 12px;
          /* auto-fit packs as many columns as fit; remaining space is redistributed so no right gap */
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        /* Optional: on very wide screens, allow slightly wider cells */
        @media (min-width: 1200px){
          #tabbed-collections-{{ section.id }} .tabs__list{
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          }
        }

        /* Buttons: allow content to wrap inside the cell */
        #tabbed-collections-{{ section.id }} .tabs__tab{
          width: 100%;
          min-height: 35px;
          min-width: 0;              /* allow children to shrink */
          padding: .7rem 1rem;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: .55rem;
          text-align: center;
        }

        /* Label: wrap + break long words if needed */
        #tabbed-collections-{{ section.id }} .tabs__label{
          white-space: normal;        /* was nowrap */
          overflow-wrap: anywhere;    /* break very long words */
          word-break: break-word;
          line-height: 1.2;
          min-width: 0;               /* avoid overflow in flex */
        }

        /* Keep icons tidy */
        #tabbed-collections-{{ section.id }} .tabs__icon-img{ width: 18px; height: 18px; flex: 0 0 auto; }


      /* Mobiletesting */

      /* Mobile-only: make tabs a horizontal scroller */
      @media (max-width: 749.98px) {
        /* Row becomes a flex, no wrapping, scrollable */
        #tabbed-collections-template--25297298260270__tabs-collections .tabs__list {
          display: flex !important;        /* override grid */
          flex-wrap: nowrap;
          overflow-x: auto;
          overflow-y: hidden;
          -webkit-overflow-scrolling: touch;
          gap: 10px;                        /* spacing between pills */
          padding: 0 12px;                  /* gutters so first/last aren't glued to edges */
          margin: 1rem 0 1.25rem;
          scroll-snap-type: x proximity;    /* nice snap on swipe */
        }

        /* Each tab is an inline pill that doesn’t shrink */
        #tabbed-collections-template--25297298260270__tabs-collections .tabs__tab {
          flex: 0 0 auto;                   /* keeps natural width; no shrinking */
          white-space: nowrap;              /* single-line label inside */
          min-height: 40px;
          scroll-snap-align: start;
        }

        /* Optional: lighten scrollbars (WebKit) */
        #tabbed-collections-template--25297298260270__tabs-collections .tabs__list::-webkit-scrollbar {
          height: 6px;
        }
        #tabbed-collections-template--25297298260270__tabs-collections .tabs__list::-webkit-scrollbar-thumb {
          background: rgba(var(--color-foreground), .25);
          border-radius: 999px;
        }
      }

      /* Mobile: 2 items per row inside tab panels */
    @media (max-width: 749.98px) {
      #tabbed-collections-template--25297298260270__tabs-collections .tabs__panel .grid {
        display: grid !important;                 /* override Dawn's flex/grid utils */
        grid-template-columns: repeat(2, minmax(0, 1fr));
        column-gap: 24px;
        row-gap: 24px;
      }
      /* Let items fill their grid cell */
      #tabbed-collections-template--25297298260270__tabs-collections .tabs__panel .grid__item {
        width: auto !important;
        max-width: none !important;
        margin: 0 !important;                     /* remove any theme margins */
      }
      /* Make each card stretch nicely */
      #tabbed-collections-template--25297298260270__tabs-collections .tabs__panel .card,
      #tabbed-collections-template--25297298260270__tabs-collections .tabs__panel .card__inner,
      #tabbed-collections-template--25297298260270__tabs-collections .tabs__panel .card__content {
        height: 100%;
      }
    }







    /* ===== Tabbed Collections — MOBILE ONLY (Safari/Chrome iOS hardening) ===== */
  /* Target the exact section AND also any future tabbed-collections section */
  @media (max-width: 749.98px){
    /* Safer selector that matches your current ID and any future clones */
    #tabbed-collections-template--25134170800430__tabs-collections .tabs__list,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .tabs__list{
      display: flex !important;          /* override grid */
      flex-wrap: nowrap;
      overflow-x: auto !important;
      overflow-y: hidden !important;
      -webkit-overflow-scrolling: touch;
      gap: 10px;
      padding: 0 12px;                    /* 8–12px gutters look good with hero */
      margin: 1rem 0 1.25rem;
      scroll-snap-type: x proximity;      /* optional snap */
    }

    /* Pills don’t shrink */
    #tabbed-collections-template--25134170800430__tabs-collections .tabs__tab,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .tabs__tab{
      flex: 0 0 auto;
      white-space: nowrap;
      min-height: 40px;
      scroll-snap-align: start;
      -webkit-tap-highlight-color: transparent;
    }

    /* Panels: only show active; add small side gutters */
    #tabbed-collections-template--25134170800430__tabs-collections .tabs__panel,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .tabs__panel{
      padding-inline: 8px;
    }
    #tabbed-collections-template--25134170800430__tabs-collections .tabs__panel.is-hidden,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .tabs__panel.is-hidden{
      display: none !important;
    }

    /* Product grid inside panels: 2-up on phones */
    #tabbed-collections-template--25134170800430__tabs-collections .tabs__panel .grid,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .tabs__panel .grid{
      display: grid !important;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      column-gap: 24px;
      row-gap: 24px;
    }
    #tabbed-collections-template--25134170800430__tabs-collections .tabs__panel .grid__item,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .tabs__panel .grid__item{
      width: auto !important;
      max-width: none !important;
      margin: 0 !important;
    }

    /* iOS image/ratio quirks */
    #tabbed-collections-template--25134170800430__tabs-collections .card__media,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .card__media{
      transform: none !important;
      will-change: auto !important;
      contain: paint;
    }
    #tabbed-collections-template--25134170800430__tabs-collections .media > img,
    [id^="tabbed-collections-template--"][id$="__tabs-collections"] .media > img{
      width: 100% !important;
      height: auto !important;
      object-fit: cover !important;
    }
  }

  /* Optional: hide the horizontal scrollbar track on WebKit without disabling scroll */
  #tabbed-collections-template--25134170800430__tabs-collections .tabs__list::-webkit-scrollbar,
  [id^="tabbed-collections-template--"][id$="__tabs-collections"] .tabs__list::-webkit-scrollbar{
    height: 0;
  }
</style>

{% schema %}
{
  "name": "Tabbed collections",
  "settings": [
    { "type": "text", "id": "kicker", "label": "Kicker" },
    { "type": "text", "id": "heading", "label": "Heading" },
    { "type": "text", "id": "subheading", "label": "Subheading" },
    { "type": "checkbox", "id": "show_card_excerpt", "label": "Show product description", "default": true },

    { "type": "collection", "id": "collection_1", "label": "Collection 1" },
    { "type": "text", "id": "label_1", "label": "Label 1" },
    { "type": "checkbox", "id": "dot_1", "label": "Show dot 1", "default": true },
    { "type": "image_picker", "id": "icon_1", "label": "Icon 1 (SVG/PNG)" },

    { "type": "collection", "id": "collection_2", "label": "Collection 2" },
    { "type": "text", "id": "label_2", "label": "Label 2" },
    { "type": "checkbox", "id": "dot_2", "label": "Show dot 2", "default": true },
    { "type": "image_picker", "id": "icon_2", "label": "Icon 2 (SVG/PNG)" },

    { "type": "collection", "id": "collection_3", "label": "Collection 3" },
    { "type": "text", "id": "label_3", "label": "Label 3" },
    { "type": "checkbox", "id": "dot_3", "label": "Show dot 3", "default": true },
    { "type": "image_picker", "id": "icon_3", "label": "Icon 3 (SVG/PNG)" },

    { "type": "collection", "id": "collection_4", "label": "Collection 4" },
    { "type": "text", "id": "label_4", "label": "Label 4" },
    { "type": "checkbox", "id": "dot_4", "label": "Show dot 4", "default": true },
    { "type": "image_picker", "id": "icon_4", "label": "Icon 4 (SVG/PNG)" },

    { "type": "collection", "id": "collection_5", "label": "Collection 5" },
    { "type": "text", "id": "label_5", "label": "Label 5" },
    { "type": "checkbox", "id": "dot_5", "label": "Show dot 5", "default": true },
    { "type": "image_picker", "id": "icon_5", "label": "Icon 5 (SVG/PNG)" },

    { "type": "collection", "id": "collection_6", "label": "Collection 6" },
    { "type": "text", "id": "label_6", "label": "Label 6" },
    { "type": "checkbox", "id": "dot_6", "label": "Show dot 6", "default": true },
    { "type": "image_picker", "id": "icon_6", "label": "Icon 6 (SVG/PNG)" },

    {
      "type": "select",
      "id": "products_limit",
      "label": "Products per tab",
      "default": "4",
      "options": [
        { "label": "4", "value": "4" },
        { "label": "8", "value": "8" },
        { "label": "12", "value": "12" }
      ]
    },
    { "type": "checkbox", "id": "show_view_all", "label": "Show “View more” button", "default": true },
    { "type": "text", "id": "view_all_label", "label": "Button label", "default": "Ver más productos" }
  ],
  "presets": [{ "name": "Tabbed collections" }]
}
{% endschema %}

<script>
  document.addEventListener('click', function (e) {
    var root = document.getElementById('tabbed-collections-{{ section.id }}');
    if (!root) return;

    var btn = e.target.closest('#tabbed-collections-{{ section.id }} .tabs__tab');
    if (!btn || !root.contains(btn)) return;

    root.querySelectorAll('.tabs__tab').forEach(function (t) {
      var active = t === btn;
      t.classList.toggle('is-active', active);
      t.setAttribute('aria-selected', active ? 'true' : 'false');
    });

    root.querySelectorAll('.tabs__panel').forEach(function (p) {
      p.classList.add('is-hidden');
    });

    var panelId = btn.getAttribute('data-target');
    if (!panelId) return;
    var panel = root.querySelector('#' + panelId);
    if (panel) panel.classList.remove('is-hidden');
  });
</script>
<style>
  /* ===== Tabbed Collections — MOBILE: make product images truly fill the card ===== */
  @media (max-width: 749.98px) {
    /* 1) Stop the padding-bottom hack so we don't fight two ratio systems */
    .tabs__panel .card__inner.ratio::before {
      content: none !important;
    }

    /* 2) Use a real aspect ratio on the card (square by default). 
        Change 1/1 to whatever you want, e.g. 4/3 or 3/4 */
    .tabs__panel .card__inner.ratio {
      aspect-ratio: 1 / 1;
      height: auto;
      position: relative;
      overflow: hidden; /* clip overflow cleanly */
    }

    /* 3) Pin media layers to the box */
    .tabs__panel .card__inner.ratio > .card__media,
    .tabs__panel .card__inner.ratio > .card__media > .media {
      position: absolute !important;
      inset: 0 !important;
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      overflow: hidden;
      contain: paint; /* iOS repaint stability */
      -webkit-backface-visibility: hidden;
      -webkit-transform: translateZ(0); /* WebKit nudge to keep sizing correct */
    }

    /* 4) Make the IMG cover the entire box */
    .tabs__panel .card__inner.ratio .media > img {
      position: absolute !important;
      inset: 0 !important;
      width: 100% !important;
      height: 100% !important;
      max-width: none !important;
      object-fit: cover !important;
      object-position: center center !important;
      transform: none !important; /* kill theme hover zoom that can shift layout */
      -webkit-mask-image: -webkit-radial-gradient(white, black); /* iOS paint fix */
    }
  }
</style>
