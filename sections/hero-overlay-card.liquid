{% comment %}
  Hero Overlay Card — Container-locked (Dawn 15.4.0)
  - Image is applied as background on the frame to prevent full-bleed
  - Class-only CSS (no IDs) so it’s safe inside the section file
{% endcomment %}

{% liquid
  assign sec = section.settings
  assign img = sec.image
  assign card_pos = sec.card_position | default: 'bottom-left'
%}

<section class="tdm-hero">
  <div class="page-width">
    <div
      class="tdm-hero__frame"
      style="
        --tdm-radius: {{ sec.corner_radius | default: 8 }}px;
        --tdm-card-max: {{ sec.card_max_width | default: 560 }}px;
        --tdm-card-pad: {{ sec.card_padding | default: 24 }}px;
        --tdm-card-opacity: {{ sec.card_bg_opacity | divided_by: 100.0 }};
        --tdm-min-h-desktop: {{ sec.min_height_desktop | default: 100 }}vh;
        --tdm-min-h-mobile: {{ sec.min_height_mobile | default: 55 }}vh;
        {% if img != blank %}background-image:url({{ img | image_url: width: 2880 }});{% endif %}
      "
    >
      {% if img == blank %}
        <div class="tdm-hero__placeholder">
          {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      {% endif %}

      <div class="tdm-hero__card tdm-hero__card--{{ card_pos }}{% if sec.card_shadow %} tdm-hero__card--shadow{% endif %}">
        <div class="tdm-hero__card-inner{% if sec.card_glass %} tdm-hero__card-inner--glass{% endif %}{% if sec.text_on_dark %} tdm-hero__card-inner--invert{% endif %}">
          {% if sec.subtitle != blank %}
            <p class="tdm-hero__eyebrow">{{ sec.subtitle }}</p>
          {% endif %}

          {% if sec.heading != blank %}
            <h2 class="tdm-hero__heading tdm-hero__heading--{{ sec.heading_size | default: 'xl' }}">
              {{ sec.heading | escape }}
            </h2>
          {% endif %}

          {% if sec.body != blank %}
            <div class="tdm-hero__body rte">{{ sec.body }}</div>
          {% endif %}

          {% if sec.button_label != blank and sec.button_link != blank %}
            <a
              href="{{ sec.button_link }}"
              class="button button--primary tdm-hero__btn{% if sec.button_pill %} tdm-hero__btn--pill{% endif %}"
            >
              {{ sec.button_label | escape }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <style>
            /* ===== Base: container + frame (class-scoped only) ===== */
            .tdm-hero .page-width{
              max-width: var(--page-width, 120rem);
              margin-inline: auto;
            }
            .tdm-hero .tdm-hero__frame{
              position: relative;
              width: 100%;
              min-height: var(--tdm-min-h-desktop);
              border-radius: var(--tdm-radius);
              overflow: hidden;
              background-color: var(--color-base-background-1, #f6f4ef);
              background-position: center;
              background-repeat: no-repeat;
              background-size: cover;
              z-index: 1; /* sit above any stray scheme layer */
            }
            @media (max-width: 749px){
              .tdm-hero .tdm-hero__frame{ min-height: var(--tdm-min-h-mobile); }
            }

            /* Placeholder */
            .tdm-hero .tdm-hero__placeholder{
              position:absolute; inset:0;
              display:flex; align-items:center; justify-content:center;
              background: rgba(var(--color-foreground), 0.04);
            }

            /* ===== Overlay card positions (desktop/tablet presets) ===== */
            @media (min-width: 750px){
              .tdm-hero .tdm-hero__card{ position:absolute; inset:auto auto 2rem 2rem; max-width:var(--tdm-card-max); }
              .tdm-hero .tdm-hero__card--top-left{ inset:2rem auto auto 2rem; }
              .tdm-hero .tdm-hero__card--top-right{ inset:2rem 2rem auto auto; }
              .tdm-hero .tdm-hero__card--bottom-right{ inset:auto 2rem 2rem auto; }
              .tdm-hero .tdm-hero__card--center-left{ top:50%; left:2rem; transform:translateY(-50%); }
              .tdm-hero .tdm-hero__card--center-right{ top:50%; right:2rem; left:auto; transform:translateY(-50%); }
            }

            /* ===== Card look ===== */
            .tdm-hero .tdm-hero__card-inner{
              background: rgba(250, 250, 250, var(--tdm-card-opacity));
              -webkit-backdrop-filter: blur(6px);
              backdrop-filter: blur(6px);
              border-radius: 12px;
              padding: var(--tdm-card-pad);
              color: {% if section.settings.text_on_dark %}rgb(var(--color-foreground)){% else %}#ffffff{% endif %} !important;
            }
            .tdm-hero .tdm-hero__card--shadow .tdm-hero__card-inner{ box-shadow: 0 8px 24px rgba(0,0,0,.15); }
            .tdm-hero .tdm-hero__card-inner--glass{ background: rgba(255,255,255, var(--tdm-card-opacity)); }
            .tdm-hero .tdm-hero__card-inner--invert{ color: rgb(var(--color-foreground)) !important; }

            /* Type (force inherit so Dawn doesn’t recolor) */
            .tdm-hero .tdm-hero__heading,
            .tdm-hero .tdm-hero__body,
            .tdm-hero .tdm-hero__eyebrow{ color: inherit !important; }
            .tdm-hero .tdm-hero__card-inner a:not(.button){
              color: inherit !important; text-decoration: underline;
            }

            /* Type sizes + spacing */
            .tdm-hero .tdm-hero__eyebrow{ margin:0 0 .25rem; letter-spacing:.04em; opacity:.85; }
            .tdm-hero .tdm-hero__heading{ margin:0 0 .5rem; line-height:1.1; }
            .tdm-hero .tdm-hero__heading--xl{ font-size: clamp(28px, 4vw, 52px); font-weight: 500; }
            .tdm-hero .tdm-hero__heading--lg{ font-size: clamp(26px, 3.2vw, 44px); }
            .tdm-hero .tdm-hero__body{ margin:0 0 1rem; }
            .tdm-hero .tdm-hero__btn{ margin-top:.25rem; }
            .tdm-hero .tdm-hero__btn--pill{ border-radius: 999px; }

            /* ===== Neutralize Dawn’s color-scheme/gradient just inside this hero ===== */
            .tdm-hero,
            .tdm-hero [class^="color-"],
            .tdm-hero [class*=" color-"],
            .tdm-hero [class*="gradient"]{ background: transparent !important; }
            .tdm-hero .gradient::before,
            .tdm-hero .section::before{ content:none !important; display:none !important; }

          /* ===== MOBILE (≤ 749.98px): improved bottom layout with 8px gap ===== */
    @media (max-width: 749.98px){
      /* Maintain consistent hero height */
      .tdm-hero .tdm-hero__frame{
        display: flex;
        flex-direction: column;
        justify-content: flex-end; /* push card to bottom */
        align-items: center;
        min-height: var(--tdm-min-h-mobile, 55vh);
        padding: 0 8px max(8px, env(safe-area-inset-bottom)); /* side + bottom space */
        box-sizing: border-box;
      }
      @supports (height: 100svh){
        .tdm-hero .tdm-hero__frame{ min-height: 55svh; }
      }
      @supports (height: 100dvh){
        .tdm-hero .tdm-hero__frame{ min-height: 55dvh; }
      }

      /* Card: natural flow, full width with nice gutters */
      .tdm-hero .tdm-hero__card{
        position: relative !important;
        inset: auto !important;
        transform: none !important;
        width: 100%;
        max-width: var(--tdm-card-max, 560px);
        margin: 0 auto; /* center horizontally */
        z-index: 2;
      }

      /* Inner card adjustments: tighter padding + reliable blur */
      .tdm-hero .tdm-hero__card-inner{
        padding: clamp(14px, 4vw, var(--tdm-card-pad, 24px));
        background: rgba(255,255,255, var(--tdm-card-opacity, .7));
        -webkit-backdrop-filter: blur(6px);
        backdrop-filter: blur(6px);
        background-clip: padding-box;
        isolation: isolate;
      }
    }
  </style>
</section>

{% schema %}
{
  "name": "Hero overlay card",
  "settings": [
    { "type": "image_picker", "id": "image", "label": "Background image" },
    { "type": "text", "id": "image_alt", "label": "Image alt text" },

    {
      "type": "range",
      "id": "min_height_desktop",
      "label": "Minimum height (desktop, vh)",
      "min": 40,
      "max": 90,
      "step": 1,
      "unit": "vh",
      "default": 70
    },
    {
      "type": "range",
      "id": "min_height_mobile",
      "label": "Minimum height (mobile, vh)",
      "min": 40,
      "max": 90,
      "step": 1,
      "unit": "vh",
      "default": 55
    },

    {
      "type": "range",
      "id": "corner_radius",
      "label": "Frame corner radius (px)",
      "min": 0,
      "max": 24,
      "step": 1,
      "default": 8
    },

    { "type": "header", "content": "Card" },
    {
      "type": "select",
      "id": "card_position",
      "label": "Card position",
      "default": "bottom-left",
      "options": [
        { "value": "bottom-left", "label": "Bottom left" },
        { "value": "bottom-right", "label": "Bottom right" },
        { "value": "top-left", "label": "Top left" },
        { "value": "top-right", "label": "Top right" },
        { "value": "center-left", "label": "Center left" },
        { "value": "center-right", "label": "Center right" }
      ]
    },
    {
      "type": "range",
      "id": "card_max_width",
      "label": "Card max width (px)",
      "min": 260,
      "max": 720,
      "step": 10,
      "default": 560
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card padding (px)",
      "min": 12,
      "max": 40,
      "step": 2,
      "default": 24
    },
    {
      "type": "range",
      "id": "card_bg_opacity",
      "label": "Card background opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 85
    },
    { "type": "checkbox", "id": "card_glass", "label": "Enable glass blur", "default": true },
    { "type": "checkbox", "id": "card_shadow", "label": "Drop shadow", "default": true },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "subtitle", "label": "Eyebrow / small label" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Vida que genera vida" },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "xl",
      "options": [
        { "label": "XL", "value": "xl" },
        { "label": "Large", "value": "lg" }
      ]
    },
    {
      "type": "richtext",
      "id": "body",
      "label": "Text",
      "default": "<p>Nuestros productos combinan ciencia y biotecnología con el poder de la naturaleza, restaurando la vida del suelo y fortaleciendo las plantas desde la raíz.</p>"
    },
    { "type": "text", "id": "button_label", "label": "Button label", "default": "Soluciones" },
    { "type": "url", "id": "button_link", "label": "Button link" },
    { "type": "checkbox", "id": "button_pill", "label": "Rounded (pill) button", "default": true },

    { "type": "checkbox", "id": "text_on_dark", "label": "Use inverted text colors", "default": false }
  ],
  "presets": [{ "name": "Hero overlay card" }]
}
{% endschema %}
