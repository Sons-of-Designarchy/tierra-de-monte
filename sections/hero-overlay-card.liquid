{% comment %}
  Hero Overlay Card — Container-locked (Dawn 15.4.0)
  - Image is applied as background on the frame to prevent full-bleed
  - Fixes Dawn color-scheme/gradient layer using correct selectors
{% endcomment %}

{% liquid
  assign sec = section.settings
  assign img = sec.image
  assign card_pos = sec.card_position | default: 'bottom-left'
%}

<section id="hero-{{ section.id }}" class="tdm-hero">
  <div class="page-width">
    <div
      class="tdm-hero__frame"
      style="
        --tdm-radius: {{ sec.corner_radius | default: 8 }}px;
        --tdm-card-max: {{ sec.card_max_width | default: 560 }}px;
        --tdm-card-pad: {{ sec.card_padding | default: 24 }}px;
        --tdm-card-opacity: {{ sec.card_bg_opacity | divided_by: 100.0 }};
        --tdm-min-h-desktop: {{ sec.min_height_desktop | default: 100 }}vh;
        --tdm-min-h-mobile: {{ sec.min_height_mobile | default: 55 }}vh;
        {% if img != blank %}background-image:url({{ img | image_url: width: 2880 }});{% endif %}
      "
    >
      {% if img == blank %}
        <div class="tdm-hero__placeholder">
          {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      {% endif %}

      <div class="tdm-hero__card tdm-hero__card--{{ card_pos }}{% if sec.card_shadow %} tdm-hero__card--shadow{% endif %}">
        <div class="tdm-hero__card-inner{% if sec.card_glass %} tdm-hero__card-inner--glass{% endif %}{% if sec.text_on_dark %} tdm-hero__card-inner--invert{% endif %}">
          {% if sec.subtitle != blank %}
            <p class="tdm-hero__eyebrow">{{ sec.subtitle }}</p>
          {% endif %}

          {% if sec.heading != blank %}
            <h2 class="tdm-hero__heading tdm-hero__heading--{{ sec.heading_size | default: 'xl' }}">
              {{ sec.heading | escape }}
            </h2>
          {% endif %}

          {% if sec.body != blank %}
            <div class="tdm-hero__body rte">{{ sec.body }}</div>
          {% endif %}

          {% if sec.button_label != blank and sec.button_link != blank %}
            <a
              href="{{ sec.button_link }}"
              class="button button--primary tdm-hero__btn{% if sec.button_pill %} tdm-hero__btn--pill{% endif %}"
            >
              {{ sec.button_label | escape }}
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <style>
        /* ===== Hero overlay — mobile-only universal gutters & height ===== */
    @media (max-width: 749.98px){
      /* Stable mobile height (with iOS toolbar-safe units when available) */
      .tdm-hero .tdm-hero__frame{
        position: relative;
        min-height: var(--tdm-min-h-mobile, 55vh);
      }
      @supports (height: 100svh){
        .tdm-hero .tdm-hero__frame{ min-height: 55svh; }
      }
      @supports (height: 100dvh){
        .tdm-hero .tdm-hero__frame{ min-height: 55dvh; }
      }

      /* Neutralize any preset card position classes on mobile */
      .tdm-hero .tdm-hero__card{
        position: absolute !important;
        inset: auto !important;
        left: 50% !important;
        right: auto !important;
        top: auto !important;
        bottom: max(8px, env(safe-area-inset-bottom)) !important; /* iPhone home bar safe */
        transform: translateX(-50%) !important;
        width: calc(100% - 16px) !important;   /* 8px gutters on both sides */
        max-width: var(--tdm-card-max, 560px) !important;
        margin: 0 !important;
        z-index: 2;
      }

      /* Slightly tighter inner padding on small screens */
      .tdm-hero .tdm-hero__card-inner{
        padding: clamp(14px, 4vw, var(--tdm-card-pad, 24px)) !important;
        background: rgba(255,255,255, var(--tdm-card-opacity, .7));
        -webkit-backdrop-filter: blur(6px);
        backdrop-filter: blur(6px);
        background-clip: padding-box;
        isolation: isolate;
      }
    }

    /* Extra guard for iOS WebKit quirkiness */
    @supports (-webkit-touch-callout: none){
      @media (max-width: 749.98px){
        .tdm-hero .tdm-hero__card{
          bottom: max(8px, env(safe-area-inset-bottom)) !important;
        }
      }
    }

          /* Page container guard */
          #hero-{{ section.id }} .page-width{
            max-width: var(--page-width, 120rem);
            margin-inline: auto;
          }

          /* Frame: rounded + background image locked to container */
          #hero-{{ section.id }} .tdm-hero__frame{
            position: relative;
            width: 100%;
            min-height: var(--tdm-min-h-desktop);
            border-radius: var(--tdm-radius);
            overflow: hidden;

            background-color: var(--color-base-background-1, #f6f4ef);
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
          }
          @media (max-width: 749px){
            #hero-{{ section.id }} .tdm-hero__frame{ min-height: var(--tdm-min-h-mobile); }
          }

          /* Placeholder if no image */
          #hero-{{ section.id }} .tdm-hero__placeholder{
            position:absolute; inset:0;
            display:flex; align-items:center; justify-content:center;
            background: rgba(var(--color-foreground), 0.04);
          }

          /* Overlay card positions */
          #hero-{{ section.id }} .tdm-hero__card{ position:absolute; inset:auto auto 2rem 2rem; max-width:var(--tdm-card-max); }
          #hero-{{ section.id }} .tdm-hero__card--top-left{ inset:2rem auto auto 2rem; }
          #hero-{{ section.id }} .tdm-hero__card--top-right{ inset:2rem 2rem auto auto; }
          #hero-{{ section.id }} .tdm-hero__card--bottom-right{ inset:auto 2rem 2rem auto; }
          #hero-{{ section.id }} .tdm-hero__card--center-left{ top:50%; left:2rem; transform:translateY(-50%); }
          #hero-{{ section.id }} .tdm-hero__card--center-right{ top:50%; right:2rem; left:auto; transform:translateY(-50%); }

          /* Card look */
        #hero-{{ section.id }} .tdm-hero__card-inner{
          background: rgba(250, 250, 250, var(--tdm-card-opacity));
          backdrop-filter: blur(6px);
          -webkit-backdrop-filter: blur(6px);
          border-radius: 12px;
          padding: var(--tdm-card-pad);

          /* ✅ Centralize color control: white by default, or theme foreground if "text_on_dark" is enabled */
          color: {% if section.settings.text_on_dark %}rgb(var(--color-foreground)){% else %}#ffffff{% endif %} !important;
        }
        #hero-{{ section.id }} .tdm-hero__card--shadow .tdm-hero__card-inner{ box-shadow: 0 8px 24px rgba(0,0,0,.15); }
        #hero-{{ section.id }} .tdm-hero__card-inner--glass{ background: rgba(255,255,255, var(--tdm-card-opacity)); }
        #hero-{{ section.id }} .tdm-hero__card-inner--invert{ color: rgb(var(--color-foreground)) !important; }

        /* Type (force inherit so Dawn doesn't paint headings/links green) */
        #hero-{{ section.id }} .tdm-hero__heading,
        #hero-{{ section.id }} .tdm-hero__body,
        #hero-{{ section.id }} .tdm-hero__eyebrow{
          color: inherit !important;
        }
        #hero-{{ section.id }} .tdm-hero__card-inner a:not(.button){
          color: inherit !important;
          text-decoration: underline;
        }

        /* Type sizes */
        #hero-{{ section.id }} .tdm-hero__eyebrow{ margin:0 0 .25rem; letter-spacing:.04em; opacity:.85; }
        #hero-{{ section.id }} .tdm-hero__heading{ margin:0 0 .5rem; line-height:1.1; }
        #hero-{{ section.id }} .tdm-hero__heading--xl{ font-size: clamp(28px, 4vw, 52px); font-weight: 500; }
        #hero-{{ section.id }} .tdm-hero__heading--lg{ font-size: clamp(26px, 3.2vw, 44px); }
        #hero-{{ section.id }} .tdm-hero__body{ margin:0 0 1rem; }

        /* Button spacing */
        #hero-{{ section.id }} .tdm-hero__btn{ margin-top:.25rem; }
        #hero-{{ section.id }} .tdm-hero__btn--pill{ border-radius: 999px; }
  </style>

  <style>
            /* === Neutralize Dawn's full-bleed color-scheme/gradient JUST for this section === */
            /* The outer wrapper Shopify gives every section */
            #shopify-section-{{ section.id }} {
              background: transparent !important;
              --gradient-background: transparent !important;
              --color-background: transparent !important;
            }

            /* Any direct child wrapper that Dawn uses to paint background/gradient */
            #shopify-section-{{ section.id }} > [class^="color-"],
            #shopify-section-{{ section.id }} > [class*=" color-"],
            #shopify-section-{{ section.id }} > [class*="gradient"],
            #shopify-section-{{ section.id }} > .section {
              background: transparent !important;
            }

            /* Inner descendants too (some blocks nest an extra wrapper) */
            #shopify-section-{{ section.id }} [class^="color-"],
            #shopify-section-{{ section.id }} [class*=" color-"],
            #shopify-section-{{ section.id }} [class*="gradient"] {
              background: transparent !important;
            }

            /* Kill any pseudo-element paints used for the scheme layer */
            #shopify-section-{{ section.id }} .gradient::before,
            #shopify-section-{{ section.id }} .section::before,
            #shopify-section-{{ section.id }}::before,
            #shopify-section-{{ section.id }}::after {
              content: none !important;
              display: none !important;
              background: transparent !important;
            }

            /* Keep this hero boxed in the site container */
            #hero-{{ section.id }} .page-width {
              max-width: var(--page-width, 120rem);
              margin-inline: auto;
            }
            #hero-{{ section.id }} .tdm-hero__frame {
              width: 100%;
              max-width: 100%;
              margin: 0;            /* avoid fake full-bleed via negative margins */
              border-radius: var(--tdm-radius);
              overflow: hidden;
              position: relative;
              z-index: 1;           /* sit above any stray scheme layer */
            }


        /* Mobile-only: center the overlay card at the bottom with 8px gutters */
        @media (max-width: 749.98px) {
          /* Frame can keep your existing mobile height */
          #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__frame {
            min-height: var(--tdm-min-h-mobile, 55vh);
            position: relative;
          }

          /* Override any “bottom-left/right/center-*” presets on mobile */
          #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__card {
            position: absolute;
            /* 8px from edges; width fills remaining space */
            left: 8px !important;
            right: 8px !important;
            bottom: 8px !important;

            top: auto !important;            /* kill any center-top variants */
            transform: none !important;      /* remove translate from center-* */
            max-width: none !important;      /* allow full width minus gutters */
            margin: 0 !important;
          }

          /* Optional: tighten inner spacing a hair on small screens */
          #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__card-inner {
            border-radius: 12px;
            padding: clamp(14px, 4vw, var(--tdm-card-pad, 24px));
          }
        }

        /* ===== Hero overlay: iOS/Chrome(iOS) fix — mobile only ===== */
    @media (max-width: 749px){
      /* Use modern viewport units on iOS so the hero height is stable */
      #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__frame{
        /* fallback for older browsers */
        min-height: var(--tdm-min-h-mobile, 55vh);
      }
      /* Prefer small/dynamic viewport on engines that support it (iOS 15+ etc.) */
      @supports (height: 100svh){
        #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__frame{
          min-height: 55svh;
        }
      }
      @supports (height: 100dvh){
        #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__frame{
          min-height: 55dvh;
        }
      }

      /* Center the card at the bottom with 8px white space (safe-area aware) */
      #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__card{
        position: absolute;
        left: 50%;
        right: auto;
        top: auto;
        bottom: max(8px, env(safe-area-inset-bottom)); /* handles iPhone notch/home bar */
        transform: translateX(-50%);
        width: calc(100% - 16px);          /* 8px on each side */
        max-width: var(--tdm-card-max, 560px);
        z-index: 2;
        inset: auto;                        /* neutralize older bottom-left inset */
      }

      /* iOS glass fix: ensure blur renders reliably */
      #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__card-inner{
        background: rgba(255,255,255, var(--tdm-card-opacity, .7));
        -webkit-backdrop-filter: blur(6px);
        backdrop-filter: blur(6px);
        background-clip: padding-box;
        isolation: isolate;                 /* prevents odd bleed-through on iOS */
      }
    }

    /* Extra safety: target iOS WebKit specifically if needed */
    @supports (-webkit-touch-callout: none){
      @media (max-width: 749px){
        #hero-template--25297298260270__hero_overlay_card_AxX4Gc .tdm-hero__card{
          bottom: max(8px, env(safe-area-inset-bottom));
        }
      }
    }
  </style>
</section>

{% schema %}
{
  "name": "Hero overlay card",
  "settings": [
    { "type": "image_picker", "id": "image", "label": "Background image" },
    { "type": "text", "id": "image_alt", "label": "Image alt text" },

    {
      "type": "range",
      "id": "min_height_desktop",
      "label": "Minimum height (desktop, vh)",
      "min": 40,
      "max": 90,
      "step": 1,
      "unit": "vh",
      "default": 70
    },
    {
      "type": "range",
      "id": "min_height_mobile",
      "label": "Minimum height (mobile, vh)",
      "min": 40,
      "max": 90,
      "step": 1,
      "unit": "vh",
      "default": 55
    },

    {
      "type": "range",
      "id": "corner_radius",
      "label": "Frame corner radius (px)",
      "min": 0,
      "max": 24,
      "step": 1,
      "default": 8
    },

    { "type": "header", "content": "Card" },
    {
      "type": "select",
      "id": "card_position",
      "label": "Card position",
      "default": "bottom-left",
      "options": [
        { "value": "bottom-left", "label": "Bottom left" },
        { "value": "bottom-right", "label": "Bottom right" },
        { "value": "top-left", "label": "Top left" },
        { "value": "top-right", "label": "Top right" },
        { "value": "center-left", "label": "Center left" },
        { "value": "center-right", "label": "Center right" }
      ]
    },
    {
      "type": "range",
      "id": "card_max_width",
      "label": "Card max width (px)",
      "min": 260,
      "max": 720,
      "step": 10,
      "default": 560
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card padding (px)",
      "min": 12,
      "max": 40,
      "step": 2,
      "default": 24
    },
    {
      "type": "range",
      "id": "card_bg_opacity",
      "label": "Card background opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 85
    },
    { "type": "checkbox", "id": "card_glass", "label": "Enable glass blur", "default": true },
    { "type": "checkbox", "id": "card_shadow", "label": "Drop shadow", "default": true },

    { "type": "header", "content": "Content" },
    { "type": "text", "id": "subtitle", "label": "Eyebrow / small label" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Vida que genera vida" },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "xl",
      "options": [
        { "label": "XL", "value": "xl" },
        { "label": "Large", "value": "lg" }
      ]
    },
    {
      "type": "richtext",
      "id": "body",
      "label": "Text",
      "default": "<p>Nuestros productos combinan ciencia y biotecnología con el poder de la naturaleza, restaurando la vida del suelo y fortaleciendo las plantas desde la raíz.</p>"
    },
    { "type": "text", "id": "button_label", "label": "Button label", "default": "Soluciones" },
    { "type": "url", "id": "button_link", "label": "Button link" },
    { "type": "checkbox", "id": "button_pill", "label": "Rounded (pill) button", "default": true },

    { "type": "checkbox", "id": "text_on_dark", "label": "Use inverted text colors", "default": false }
  ],
  "presets": [{ "name": "Hero overlay card" }]
}
{% endschema %}
