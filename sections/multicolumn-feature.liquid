{{ 'section-multicolumn.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding { padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px; padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px; }
  @media (min-width: 750px) { .section-{{ section.id }}-padding { padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px; } }

  /* ===== Feature layout (title/desc/CTA left, columns right) ===== */
  #shopify-section-{{ section.id }} .mc-feature__grid { display: grid; gap: 32px; }
  @media (min-width: 990px){ #shopify-section-{{ section.id }} .mc-feature__grid { grid-template-columns: 5fr 7fr; align-items: start; gap: 48px; } }
  #shopify-section-{{ section.id }} .mc-feature__lead { display:flex; flex-direction:column; gap: 16px; }
  #shopify-section-{{ section.id }} .mc-eyebrow { font-family: var(--font-body-family); font-size: 12px; letter-spacing: .12em; text-transform: uppercase; opacity:.8; }
  #shopify-section-{{ section.id }} .mc-eyebrow__rule { width: 100%; max-width: 520px; height: 2px; background: {{ section.settings.rule_color }}; margin-top: 8px; }
  #shopify-section-{{ section.id }} .mc-heading { margin: 0; }
  #shopify-section-{{ section.id }} .mc-desc { color: rgb(var(--color-foreground), .8); }
  #shopify-section-{{ section.id }} .mc-cta-wrap { margin-top: 8px; }

  /* ===== Columns area ===== */
  #shopify-section-{{ section.id }} .multicolumn { border-radius: 8px; background: transparent; }
  #shopify-section-{{ section.id }} .multicolumn__title { display:none; }
  #shopify-section-{{ section.id }} .multicolumn-list { align-items: start; }

  /* Vertical dividers between items (desktop only) */
  @media(min-width: 990px){
    #shopify-section-{{ section.id }} .multicolumn-list__item { position: relative; padding-left: 8px; height: 60vh; }
    #shopify-section-{{ section.id }} .multicolumn-list__item + .multicolumn-list__item { border-left: 1px solid {{ section.settings.divider_color }}; }
  }

  /* Stat style (optional if you want larger numeric headlines) */
  #shopify-section-{{ section.id }} .multicolumn-card h3 { margin-bottom: 4px; }
{%- endstyle -%}
<style>
      /* Target this section only */
      #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card__image-wrapper .media {
        position: relative;
        border-radius; 8px;
        padding-bottom: 0 !important; /* cancel Dawn’s ratio padding if modifier is broken */
        aspect-ratio: 1 / 1; /* pick a sane default (square) */
        display: block;
      }

      #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card__image {
        position: static !important; /* cancel absolute positioning from media component */
          width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
      }

      /* Neutralize the broken width class if it appears */
      #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card__image-wrapper---width {
        all: unset;
      }

      /* Make each card a vertical stack and push the image to the bottom */
    #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card {
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: 100%;
    }

    /* Info first */
    #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card__info {
      order: 1;
    }

    /* Image last and stuck to the bottom */
    #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card__image-wrapper {
      order: 3;
      margin-top: auto;       /* pushes image block to the bottom */
      width: 100%;
    }



    /* Stat/heading size: minimum 61px */
    #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card h3 {
      font-size: clamp(61px, 6vw, 96px);
      line-height: 1;
      margin: 0 0 4px;
    }


    #shopify-section-template--25297298260270__multicolumn_feature_mjeJtX .multicolumn-card__image-wrapper {
    border-radius: 8px;
    overflow: hidden;
  }
</style>

{%- liquid
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and section.blocks.size > columns_mobile_int
    assign show_mobile_slider = true
  endif
-%}

<div class="multicolumn color-{{ section.settings.color_scheme }} gradient background-{{ section.settings.background_style }}">
  <div
    class="page-width section-{{ section.id }}-padding isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
    {% if settings.animations_reveal_on_scroll %}
      data-cascade
    {% endif %}
  >
    <div class="mc-feature__grid">
      <!-- Left: Eyebrow + Title + Description + CTA -->
      <div class="mc-feature__lead">
        {% if section.settings.pretitle != blank %}
          <div class="mc-eyebrow">
            {{ section.settings.pretitle }}
            {% if section.settings.show_rule %}
              <div class="mc-eyebrow__rule" aria-hidden="true"></div>
            {% endif %}
          </div>
        {% endif %}
        {% if section.settings.title != blank %}
          <h2 class="mc-heading title inline-richtext {{ section.settings.heading_size }}">
            {{ section.settings.title }}
          </h2>
        {% endif %}
        {% if section.settings.description != blank %}
          <div class="mc-desc rte">{{ section.settings.description }}</div>
        {% endif %}
        {% if section.settings.button_label != blank %}
          <div class="mc-cta-wrap">
            <a
              class="button button--primary"
              {% if section.settings.button_link == blank %}
                role="link" aria-disabled="true"
              {% else %}
                href="{{ section.settings.button_link }}"
              {% endif %}
            >
              {{ section.settings.button_label | escape }}
            </a>
          </div>
        {% endif %}
      </div>

      <!-- Right: Columns / Stats -->
      <div>
        <slider-component class="slider-mobile-gutter">
          <ul
            class="multicolumn-list contains-content-container grid grid--{{ section.settings.columns_mobile }}-col-tablet-down grid--{{ section.settings.columns_desktop }}-col-desktop{% if show_mobile_slider %} slider slider--tablet grid--peek{% endif %}"
            id="Slider-{{ section.id }}"
            role="list"
          >
            {%- liquid
              assign highest_ratio = 0
              for block in section.blocks
                if block.settings.image.aspect_ratio > highest_ratio
                  assign highest_ratio = block.settings.image.aspect_ratio
                endif
              endfor
            -%}
            {%- for block in section.blocks -%}
              {%- assign empty_column = '' -%}
              {%- if block.settings.image == blank
                and block.settings.title == blank
                and block.settings.text == blank
                and block.settings.link_label == blank
              -%}
                {%- assign empty_column = ' multicolumn-list__item--empty' -%}
              {%- endif -%}

              <li
                id="Slide-{{ section.id }}-{{ forloop.index }}"
                class="multicolumn-list__item grid__item{% if section.settings.swipe_on_mobile %} slider__slide{% endif %}{% if section.settings.column_alignment == 'center' %} center{% endif %}{{ empty_column }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
                {{ block.shopify_attributes }}
                {% if settings.animations_reveal_on_scroll %}
                  data-cascade style="--animation-order: {{ forloop.index }};"
                {% endif %}
              >
                <div class="multicolumn-card content-container">
                  {%- if block.settings.image != blank -%}
                    {% if section.settings.image_ratio == 'adapt' or section.settings.image_ratio == 'circle' -%}
                      `
                      {% assign spaced_image = true %}
                    {% endif %}
                    <div class="multicolumn-card__image-wrapper multicolumn-card__image-wrapper--{{ section.settings.image_width }}-width{% if section.settings.image_width != 'full' or spaced_image %} multicolumn-card-spacing{% endif %}">
                      <div
                        class="media media--transparent media--{{ section.settings.image_ratio }}"
                        {% if section.settings.image_ratio == 'adapt' %}
                          style="padding-bottom: {{ 1 | divided_by: highest_ratio | times: 100 }}%;"
                        {% endif %}
                      >
                        {%- liquid
                          assign number_of_columns = section.settings.columns_desktop
                          assign number_of_columns_mobile = section.settings.columns_mobile
                          assign grid_space_desktop = number_of_columns | minus: 1 | times: settings.spacing_grid_horizontal | plus: 100 | append: 'px'
                          assign grid_space_tablet = number_of_columns_mobile | minus: 1 | times: settings.spacing_grid_horizontal | plus: 100 | append: 'px'
                          assign grid_space_mobile = number_of_columns_mobile | minus: 1 | times: settings.spacing_grid_horizontal | divided_by: 2 | plus: 30 | append: 'px'
                          if section.settings.image_width == 'half'
                            assign image_width = 0.5
                          elsif section.settings.image_width == 'third'
                            assign image_width = 0.33
                          else
                            assign image_width = 1
                          endif
                        -%}
                        {% capture sizes %}
                          (min-width: {{ settings.page_width }}px) calc(({{ settings.page_width }}px - {{ grid_space_desktop }}) * {{ image_width }} /  {{ number_of_columns }}),
                          (min-width: 990px) calc((100vw - {{ grid_space_desktop }}) * {{ image_width }} / {{ number_of_columns }}),
                          (min-width: 750px) calc((100vw - {{ grid_space_tablet }}) * {{ image_width }} / {{ number_of_columns_mobile }}),
                          calc((100vw - {{ grid_space_mobile }}) * {{ image_width }} / {{ number_of_columns_mobile }})
                        {% endcapture %}
                        {% if block.settings.image != blank %}
                          <div class="multicolumn-card__image-wrapper multicolumn-card-spacing">
                            <div class="media media--transparent media--adapt">
                              {{
                                block.settings.image
                                | image_url: width: 3200
                                | image_tag:
                                  class: 'multicolumn-card__image',
                                  loading: 'lazy',
                                  sizes: '(min-width: 1400px) calc((1400px - 116px) * 1 / 3), (min-width: 990px) calc((100vw - 116px) * 1 / 3), (min-width: 750px) calc((100vw - 100px) * 1 / 1), calc((100vw - 30px) * 1 / 1)'
                              }}
                            </div>
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  {%- endif -%}
                  <div class="multicolumn-card__info">
                    {%- if block.settings.title != blank -%}
                      <h3 class="inline-richtext">{{ block.settings.title }}</h3>
                    {%- endif -%}
                    {%- if block.settings.text != blank -%}
                      <div class="rte">{{ block.settings.text }}</div>
                    {%- endif -%}
                    {%- if block.settings.link_label != blank -%}
                      <a
                        class="link animate-arrow"
                        {% if block.settings.link == blank %}
                          role="link" aria-disabled="true"
                        {% else %}
                          href="{{ block.settings.link }}"
                        {% endif %}
                      >
                        {{- block.settings.link_label | escape -}}
                        <span class="svg-wrapper"
                          ><span class="icon-wrap">&nbsp;{{ 'icon-arrow.svg' | inline_asset_content }}</span></span
                        >
                      </a>
                    {%- endif -%}
                  </div>
                </div>
              </li>
            {%- endfor -%}
          </ul>

          {%- if show_mobile_slider -%}
            <div class="slider-buttons large-up-hide">
              <button
                type="button"
                class="slider-button slider-button--prev"
                name="previous"
                aria-label="{{ 'general.slider.previous_slide' | t }}"
              >
                <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
              </button>
              <div class="slider-counter caption">
                <span class="slider-counter--current">1</span><span aria-hidden="true"> / </span
                ><span class="visually-hidden">{{ 'general.slider.of' | t }}</span
                ><span class="slider-counter--total">{{ section.blocks.size }}</span>
              </div>
              <button
                type="button"
                class="slider-button slider-button--next"
                name="next"
                aria-label="{{ 'general.slider.next_slide' | t }}"
              >
                <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
              </button>
            </div>
          {%- endif -%}
        </slider-component>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Multicolumn — Feature",
  "class": "section",
  "tag": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "pretitle",
      "label": "Pre-title (eyebrow)",
      "default": "SOLUCIONES ESTRATÉGICAS, RESULTADOS EXCEPCIONALES"
    },
    { "type": "color", "id": "rule_color", "label": "Eyebrow rule color", "default": "#294E3F" },
    { "type": "checkbox", "id": "show_rule", "label": "Show eyebrow rule", "default": true },

    {
      "type": "inline_richtext",
      "id": "title",
      "default": "Efecto Tierra de monte\nInnovación que siembra futuro",
      "label": "Title"
    },
    {
      "type": "richtext",
      "id": "description",
      "default": "<p>Nuestros productos están respaldados por ciencia y diseñados para trabajar en equilibrio con la naturaleza...</p>",
      "label": "Description"
    },

    { "type": "text", "id": "button_label", "label": "Button label", "default": "Encuentra tu solución" },
    { "type": "url", "id": "button_link", "label": "Button link" },

    {
      "type": "select",
      "id": "heading_size",
      "options": [
        { "value": "h2", "label": "H2" },
        { "value": "h1", "label": "H1" },
        { "value": "h0", "label": "H0" },
        { "value": "hxl", "label": "HXL" },
        { "value": "hxxl", "label": "HXXL" }
      ],
      "default": "h1",
      "label": "Heading size"
    },

    { "type": "header", "content": "Layout" },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "Columns on desktop"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "1",
      "label": "Columns on mobile"
    },
    { "type": "checkbox", "id": "swipe_on_mobile", "default": false, "label": "Swipe on mobile" },
    { "type": "color", "id": "divider_color", "label": "Divider color (desktop)", "default": "#1a1a1a" },

    { "type": "header", "content": "Visual" },
    {
      "type": "select",
      "id": "background_style",
      "options": [
        { "value": "none", "label": "None" },
        { "value": "primary", "label": "Primary" }
      ],
      "default": "primary",
      "label": "Card background"
    },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },

    { "type": "header", "content": "Padding" },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "inline_richtext", "id": "title", "default": "+230", "label": "Heading / Stat" },
        { "type": "richtext", "id": "text", "default": "<p>Hectáreas regeneradas</p>", "label": "Text" },
        { "type": "text", "id": "link_label", "label": "Link label" },
        { "type": "url", "id": "link", "label": "Link" }
      ]
    }
  ],
  "presets": [
    { "name": "Multicolumn — Feature", "blocks": [{ "type": "column" }, { "type": "column" }, { "type": "column" }] }
  ]
}
{% endschema %}
