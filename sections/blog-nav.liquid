{% comment %}
  Blog Nav (Dawn 15.4.0 compatible) — MOBILE FIXED
  - Mobile: label on top + horizontally scrollable “pill” tabs (no squished text)
  - Desktop: keeps your segmented-control look
  - Uses theme tokens (no hard-coded colors)
{% endcomment %}

<section id="shopify-section-{{ section.id }}" class="blog-nav color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width section-{{ section.id }}-padding">
    <nav
      class="blog-nav__bar"
      role="navigation"
      aria-label="{{ section.settings.label | default: 'Explora nuestro blog' }}"
    >
      {%- if section.settings.label != blank -%}
        <span class="blog-nav__label">{{ section.settings.label }}</span>
      {%- endif -%}

      <ul class="blog-nav__list" role="list">
        {%- for block in section.blocks -%}
          {%- assign chosen_blog = blogs[block.settings.blog] -%}
          {%- if chosen_blog -%}
            {%- liquid
              assign is_active = false
              if request.page_type == 'blog' and blog and blog.id == chosen_blog.id
                assign is_active = true
              endif
            -%}
            <li class="blog-nav__item" {{ block.shopify_attributes }}>
              <a
                class="blog-nav__btn{% if is_active %} is-active{% endif %}"
                href="{{ chosen_blog.url }}"
              >
                {{ block.settings.title | default: chosen_blog.title }}
              </a>
            </li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </nav>
  </div>

  {%- style -%}
        /* ===== Instance scope ===== */
        .section-{{ section.id }}-padding {
          padding-top: {{ section.settings.padding_top | times: 0.75 | round }}px;
          padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round }}px;
        }
        @media (min-width: 750px) {
          .section-{{ section.id }}-padding {
            padding-top: {{ section.settings.padding_top }}px;
            padding-bottom: {{ section.settings.padding_bottom }}px;
          }
        }

        /* Bar layout */
        #shopify-section-{{ section.id }} .blog-nav__bar {
          display: flex;
          align-items: center;
          gap: 16px;
        }

        /* Label (monospaced) */
        #shopify-section-{{ section.id }} .blog-nav__label {
          font-family: var(--font-mono-family, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
          font-size: 12px;
          letter-spacing: .12em;
          text-transform: uppercase;
          line-height: 1;
          color: rgb(var(--color-foreground));
          white-space: nowrap;
        }

        /* List of buttons (DESKTOP segmented control) */
        #shopify-section-{{ section.id }} .blog-nav__list {
          display: flex;
          align-items: stretch;
          gap: 0; /* separators are drawn by borders */
          margin: 0;
          padding: 0;
          list-style: none;
          width: 100%;
          border: 1px solid rgba(var(--color-foreground), .8);
          border-radius: 10px;
          overflow: hidden; /* keep rounded ends clean */
          background: rgb(var(--color-background));
        }

        #shopify-section-{{ section.id }} .blog-nav__item {
          flex: 1 1 auto;
          min-width: 0;
        }

        #shopify-section-{{ section.id }} .blog-nav__btn {
          display: inline-flex;
          width: 100%;
          justify-content: center;
          align-items: center;
          padding: 12px 18px;
          text-decoration: none;
          color: rgb(var(--color-foreground));
          line-height: 1.1;
          background: transparent;
          transition: background-color .2s ease, color .2s ease;
          position: relative;

          /* prevent awkward wrapping on desktop */
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        /* Vertical separators between buttons (desktop only; mobile will override) */
        #shopify-section-{{ section.id }} .blog-nav__item + .blog-nav__item .blog-nav__btn {
          border-left: 1px solid rgba(var(--color-foreground), .6);
        }

        /* Hover/Focus (token-based, no hard-coded colors) */
        #shopify-section-{{ section.id }} .blog-nav__btn:hover,
        #shopify-section-{{ section.id }} .blog-nav__btn:focus-visible {
          background: rgba(var(--color-foreground), .08);
          outline: none;
        }

        /* Active button (current blog) */
        #shopify-section-{{ section.id }} .blog-nav__btn.is-active {
          background: rgb(var(--color-button));
          color: rgb(var(--color-button-text));
        }

        /* =========================================================
           MOBILE FIX (≤749px)
           - Stack label
           - Turn list into horizontal scroll "pills"
           - Remove segmented separators to avoid squished columns
           ========================================================= */
        @media (max-width: 749px) {
          #shopify-section-{{ section.id }} .blog-nav__bar {
            flex-direction: column;
            align-items: stretch;
            gap: 10px;
          }

          #shopify-section-{{ section.id }} .blog-nav__label {
            align-self: flex-start;
          }

          /* Horizontal scrolling rail */
          #shopify-section-{{ section.id }} .blog-nav__list {
            width: 100%;
            border-radius: 14px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;

            /* turn into “rail” instead of equal-width columns */
            align-items: center;
            padding: 8px;
            gap: 8px;
          }

          /* Hide scrollbar (still scrollable) */
          #shopify-section-{{ section.id }} .blog-nav__list::-webkit-scrollbar { height: 0; }
          #shopify-section-{{ section.id }} .blog-nav__list { scrollbar-width: none; }

          /* Items become natural width pills */
          #shopify-section-{{ section.id }} .blog-nav__item {
            flex: 0 0 auto;
            min-width: auto;
          }

          /* Pills */
          #shopify-section-{{ section.id }} .blog-nav__btn {
            width: auto;
            padding: 10px 14px;
            border-radius: 999px;
            border: 1px solid rgba(var(--color-foreground), .25);

            /* allow long labels without breaking layout */
            max-width: 75vw;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          /* Remove desktop separators on mobile */
          #shopify-section-{{ section.id }} .blog-nav__item + .blog-nav__item .blog-nav__btn {
            border-left: none;
          }

          /* Active pill */
          #shopify-section-{{ section.id }} .blog-nav__btn.is-active {
            border-color: rgba(var(--color-foreground), .0);
          }
        }


        /* =================================================
       Blog Nav — MOBILE: remove container completely
       ================================================= */
    @media (max-width: 749px) {

      /* Kill the container look */
      #shopify-section-{{ section.id }} .blog-nav__list {
        border: none !important;
        border-radius: 0 !important;
        background: transparent !important;
        padding: 0 !important;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      /* Hide scrollbar (WebKit) */
      #shopify-section-{{ section.id }} .blog-nav__list::-webkit-scrollbar {
        display: none;
      }

      /* Items should NOT stretch */
      #shopify-section-{{ section.id }} .blog-nav__item {
        flex: 0 0 auto;
      }

      /* Remove vertical separators */
      #shopify-section-{{ section.id }}
      .blog-nav__item + .blog-nav__item .blog-nav__btn {
        border-left: none !important;
      }

      /* Buttons become standalone pills */
      #shopify-section-{{ section.id }} .blog-nav__btn {
        border: 1px solid rgba(var(--color-foreground), .6);
        border-radius: 999px;
        padding: 10px 16px;
        white-space: nowrap;
        background: transparent;
      }

      /* Space between pills */
      #shopify-section-{{ section.id }} .blog-nav__list {
        gap: 8px;
      }
    }
  {%- endstyle -%}
</section>

{% schema %}
{
  "name": "Blog navigation",
  "tag": "section",
  "class": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "label",
      "label": "Label",
      "default": "Explora nuestro blog"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 24
    }
  ],
  "blocks": [
    {
      "type": "blog_link",
      "name": "Blog button",
      "settings": [
        {
          "type": "blog",
          "id": "blog",
          "label": "Blog"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Label override",
          "info": "Optional; defaults to the blog title"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Blog navigation",
      "blocks": [{ "type": "blog_link" }, { "type": "blog_link" }, { "type": "blog_link" }, { "type": "blog_link" }]
    }
  ]
}
{% endschema %}
